<!DOCTYPE html>
<html>
<meta charset = "UTF-8">
<style type="text/css">
	.LText { font-family: Courier; font-size:16px; font-weight:bold; vertical-align: top; text-align: left; background-color: white; }
	.RText { font-family: Courier; font-size:16px; font-weight:bold; vertical-align: top; text-align: right; background-color: white; }
	.CText { font-family: Courier; font-size:16px; font-weight:bold; vertical-align: top; text-align: center; color: black; background-color: white; }
    .Table { display:table }
    .Row { display: table-row; background-color: white; height: 40px; }
    .Cell { display: table-cell; vertical-align: top; text-align: left; border: 0px solid black; padding-left: 5px; padding-right: 5px; }
    .MapCell { display: table-cell; column-span:2; vertical-align: top; border: 0px solid black; padding-left: 0px; padding-right: 0px; width:1000px}
	.Slider { width: 300px; height: 15px; -webkit-appearance: none; -webkit-transition:0.2s; background-color:lightgray; outline:none; opacity:0.7s; transition: opacity 0.2s; }
	.Slider:hover { opacity:1 }
	.Slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 35px; height: 25px; background: black; cursor: pointer; }
	.Slider::-moz-range-thumb { width: 35px; height: 25px; background: black; cursor: pointer; }
	.ShortSlider { width:100px; height: 25px; -webkit-appearance: none; -webkit-transition:0.2s; background-color:lightgray; outline:none; opacity:0.7s; transition: opacity 0.2s; }
	.ShortSlider:hover { opacity:1 }
	.ShortSlider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 25px; height: 25px; background: #4CAF50; cursor: pointer; }
	.ShortSlider::-moz-range-thumb { width: 25px; height: 25px; background: #4CAF50; cursor: pointer; }
</style>
<body>
<div class = "Table">
	<div class = "Row">
		<div class = "MapCell">
			<canvas id="USAMap" width=1200 height=620 style="border:0px solid #ffffff; background-color:white;">
			Your browser does not support HTML5
			</canvas>
		</div>
	</div>
	<div class = "Row">
			<div class = "Cell">
				<label class = "LText">Date Select:</label>
				<input type="range" class=Slider min=0 max=1 value=1 id="DateCtrl">
				<label class = "CText" id="CurrentDateSet">No Date</label>
				<label></label>
				<label class = "LText"><font size=-1><i>and also </i></font>Map Select:</label>
				<!-- <input type="range" class=ShortSlider min=0 max=1 value=1 id="DisplayCtrl"> -->
				<select class = "CText" id=DisplaySelect></select>
				<!-- <label class = "CText" id="DisplaySet">Map Description</label> -->
			</div>
	</div>
</div>

</body>

<script src=USBorders.js></script>
<script src=Cities.js></script>
<script src=USAData.js></script>
<script src=USAData_60.js></script>
<script src=USAData_61.js></script>
<script src=USAData_62.js></script>
<script src=USAData_63.js></script>
<script src=USAData_64.js></script>
<script src=USAData_65.js></script>
<script src=USAData_66.js></script>
<script src=USAData_67.js></script>
<script src=USAData_68.js></script>
<script src=USAData_69.js></script>
<script src=USAData_70.js></script>
<script src=USAData_71.js></script>
<script src=USAData_72.js></script>
<script src=USAData_73.js></script>
<script src=USAData_74.js></script>
<script src=USAData_75.js></script>
<script src=USAData_76.js></script>
<script src=USAData_77.js></script>
<script src=USAData_78.js></script>
<script src=USAData_79.js></script>
<script src=USAData_80.js></script>
<script src=USAData_81.js></script>
<script src=USAData_82.js></script>
<script src=USAData_83.js></script>
<script src=USAData_84.js></script>
<script src=USAData_85.js></script>
<script src=USAData_86.js></script>
<script src=USAData_87.js></script>
<script src=USAData_88.js></script>
<script src=USAData_89.js></script>
<script src=USAData_90.js></script>
<script src=USAData_91.js></script>
<script src=USAData_92.js></script>
<script src=USAData_93.js></script>
<script src=USAData_94.js></script>
<script src=USAData_95.js></script>
<script src=USAData_96.js></script>
<script src=USAData_97.js></script>
<script src=USAData_98.js></script>
<script src=USAData_99.js></script>
<script src=USAData_100.js></script>
<script src=USAData_101.js></script>
<script src=USAData_102.js></script>
<script src=USAData_103.js></script>
<script src=USAData_104.js></script>
<script src=USAData_105.js></script>
<script src=USAData_106.js></script>
<script src=USAData_107.js></script>
<script src=USAData_108.js></script>
<script src=USAData_109.js></script>
<script src=USAData_110.js></script>
<script src=USAData_111.js></script>
<script src=USAData_112.js></script>
<script src=USAData_113.js></script>
<script src=USAData_114.js></script>
<script src=USAData_115.js></script>
<script src=USAData_116.js></script>

<script>

var MinLat = 25;
var MaxLat = 49;
var MinLng = -124;
var MaxLng = -67;
var MagnifierX = 17;
var MagnifierY = 19;
function MapToCanvasX(x) { return((x + 125) * MagnifierX); }
function MapToCanvasY(y) { return((50 - y) * MagnifierY); }
// function MapToCanvasX(x) { return(x + (-1 * (MinLng-1)) * MagnifierX); }
// function MapToCanvasY(y) { return(((MaxLat+1) - y) * MagnifierY); }
function MapToHeatMapX(x) { return(Math.floor(x - MinLng)); }
function MapToHeatMapY(y) { return(Math.floor(MaxLat - (y - MinLat))); }

function DecToHex(h)
{
	if(h < 0)
		return("00");
	if(h < 15)
		return("0" + h.toString(16));
	if(h > 255)
		return("ff");
	return(h.toString(16));
}

function ClearScreen()
{
	// clear canvas
	ctx.globalAlpha = 1.0;
	// ctx.fillStyle = "darkgray";
	ctx.fillStyle = "white";
	ctx.fillRect(0,0,canvas.width,canvas.height);
}

function DrawUSAMap()
{
	var x,y;
	var Lat,Lng;
	var Radius;
	// draw map
	ctx.lineWidth = 1;
	// ctx.fillStyle = "#ffffff";
	// ctx.strokeStyle = "#b2babb";
	ctx.strokeStyle = "black";
	for(x=0;x<Object.keys(States).length;x++)
	{
		ctx.beginPath();
		ctx.moveTo(	MapToCanvasX(Object.values(States)[x].Coordinates[0].lng),
					MapToCanvasY(Object.values(States)[x].Coordinates[0].lat));
		for(y=1;y<Object.values(States)[x].Coordinates.length;y++)
		{
			ctx.lineTo(	MapToCanvasX(Object.values(States)[x].Coordinates[y].lng),
						MapToCanvasY(Object.values(States)[x].Coordinates[y].lat))
		}
		ctx.closePath();
		// ctx.fill();
		ctx.stroke();

		/*
		for(y=0;y<Object.values(States)[x].Coordinates.length;y++)
		{
			if(MinLng > Object.values(States)[x].Coordinates[y].lng)
				MinLng = Object.values(States)[x].Coordinates[y].lng;
			if(MaxLng < Object.values(States)[x].Coordinates[y].lng)
				MaxLng = Object.values(States)[x].Coordinates[y].lng;
			if(MinLat > Object.values(States)[x].Coordinates[y].lat)
				MinLat = Object.values(States)[x].Coordinates[y].lat;
			if(MaxLat < Object.values(States)[x].Coordinates[y].lat);
				MaxLat = Object.values(States)[x].Coordinates[y].lat;
		}
		*/
	}

	// draw city locations
	ctx.globalAlpha = 1.0;
	ctx.strokeStyle = "darkgray";
	ctx.lineWidth = 1;
	ctx.font = "normal 8pt courier";
	for(x=0;x<CityData.length;x++)
	{
		Lat = MapToCanvasY(CityData[x].Lat);
		Lng = MapToCanvasX(CityData[x].Lng);

		if(CityData[x].Pop2010 > 3000000)
			Radius = 5;
		else
			if(CityData[x].Pop2010 > 2000000)
				Radius = 4;
			else
				if(CityData[x].Pop2010 > 1000000)
					Radius = 3;
				else
					Radius = 2;

		ctx.fillStyle = "black";
		ctx.beginPath();
		ctx.arc(Lng,Lat,Radius,0,2*Math.PI);
		ctx.fill();
		ctx.closePath();
		switch(CityData[x].Orient)
		{
			case	0	:
							ctx.textAlign = "left";
							ctx.textBaseline = "middle";
							ctx.fillText(" " + CityData[x].City,MapToCanvasX(CityData[x].Lng),MapToCanvasY(CityData[x].Lat));
							break;
			case	1	:
							ctx.textAlign = "right";
							ctx.textBaseline = "middle";
							ctx.fillText(CityData[x].City + " ",MapToCanvasX(CityData[x].Lng),MapToCanvasY(CityData[x].Lat));
							break;
			case	2	:
							ctx.textAlign = "center";
							ctx.textBaseline = "top";
							ctx.fillText(CityData[x].City,MapToCanvasX(CityData[x].Lng),MapToCanvasY(CityData[x].Lat)+2);
							break;
			case	3	:
							ctx.textAlign = "center";
							ctx.textBaseline = "bottom";
							ctx.fillText(CityData[x].City,MapToCanvasX(CityData[x].Lng),MapToCanvasY(CityData[x].Lat)+2);
							break;
		}
		// ctx.strokeText(CityData[x].City,MapToCanvasX(CityData[x].Lng),MapToCanvasY(CityData[x].Lat));
	}

	ctx.textAlign = "left";
	ctx.textBaseline = "bottom";

	if(ClickDataCategory == 1)
		ctx.fillStyle = "black";
	else
		ctx.fillStyle = "darkgray";
	ctx.beginPath();
	ctx.arc(SevereClickArea1[0],SevereClickArea1[1],SevereClickArea1Radius,0,2*Math.PI);
	ctx.fill();
	ctx.closePath();
	ctx.fillText("<-click here to see locations with most cases",SevereClickArea1[0]+10,SevereClickArea1[1]+6);

	if(ClickDataCategory == 2)
		ctx.fillStyle = "black";
	else
		ctx.fillStyle = "darkgray";
	ctx.beginPath();
	ctx.arc(SevereClickArea2[0],SevereClickArea2[1],SevereClickArea2Radius,0,2*Math.PI);
	ctx.fill();
	ctx.closePath();
	ctx.fillText("<-click here to see locations with most cases per capita",SevereClickArea2[0]+10,SevereClickArea2[1]+6);

	ctx.textBaseline = "bottom";

	/*
	MinLng = Math.floor(MinLng);
	MaxLng = Math.ceil(MaxLng);
	MinLat = Math.floor(MinLat);
	MaxLat = Math.ceil(MaxLat);

	// console.log("MinLng = " + MinLng + " MaxLng = " + MaxLng);
	// console.log("MinLat = " + MinLat + " MaxLat = " + MaxLat);

	// draw lat/long lines
	ctx.fillStyle = "#000000";
	for(y=25;y<50;y++)
	{
		for(x=-124;x<-66;x++)
		{
			ctx.fillRect(MapToCanvasX(x),MapToCanvasY(y),2,2);
			// console.log("x = " + MapToCanvasX(x) + " y = " + MapToCanvasY(y));
		}
	}
	*/
}

// figure out max values
function PrepData()
{
	var di,x,y,z;
	var TransLng,TransLat;

	for(di=0;di<ReportDate.length;di++)
	// if(!ReportDate[DateIndex].Prepped)
	{
		for(x=0;x<ReportDate[di].Data.length;x++)
		{
			var Data = ReportDate[di].Data[x];

			// round lat/long values to 6 digits - the higher precision digits appear to be inaccurate across different reporting days

			Data.Long = Number(Number(Data.Long).toFixed(6));
			Data.Lat = Number(Number(Data.Lat).toFixed(6));
		
			Data.ScaledCases = Math.floor(Math.sqrt(ReportDate[di].Data[x].Cases));

			// make specific check to add population stats for New York City since it's not a county, but relevant to this display.
			// this will let the chart calculations happen later in the logic even though it's county level logic.
			if(Data.Adm.localeCompare("New York City") == 0)
				Data.Pop = 8175133;	// Census 2010 population for New York

			// if((Data.Pop > 0) && (Data.Cases > 0))
			if(Data.Pop > 0)
			{
				Data.PerCapita = Data.Cases / Data.Pop;
				Data.DeathsPerCapita = Data.Deaths / Data.Pop;
				if(Data.Cases > 0)
					Data.DeathRate = Data.Deaths / Data.Cases;
				else
					Data.DeathRate = 0;
				// console.log("dr = " + Data.DeathRate + " d = " + Data.Deaths + " c = " + Data.Cases);
			}
			else
			{
				Data.PerCapita = 0;
				Data.DeathsPerCapita = 0;
				Data.DeathRate = 0;
			}

			// put cases into heat map
			if(Data.Long != 0)
			{
				TransLng = MapToHeatMapX(Data.Long);
				TransLat = MapToHeatMapY(Data.Lat);
				if( (TransLng >= 0) && (TransLat >= 0) && 
					(TransLng < ReportDate[di].CaseMap.length) && 
					(TransLat < ReportDate[di].CaseMap[TransLng].length))
				{
					ReportDate[di].CaseMap[TransLng][TransLat] += Data.Cases;
					ReportDate[di].PopMap[TransLng][TransLat] += Data.Pop;
				}
			}
		}

		ReportDate[di].MostPerCapitaIndex = new Array(MaxSummary);
		ReportDate[di].MostCasesIndex = new Array(MaxSummary);

		for(y=0;y<MaxSummary;y++)
		{
			ReportDate[di].MostPerCapitaIndex[y] = 0;
			ReportDate[di].MostCasesIndex[y] = 0;
		}

		// now sort out worse off areas.
		for(x=0;x<ReportDate[di].Data.length;x++)
		{
			var Data = ReportDate[di].Data[x];

			for(z=0;z<MaxSummary;z++)
			{
				if(Data.Cases > ReportDate[di].Data[ReportDate[di].MostCasesIndex[z]].Cases)
				{
					for(y=MaxSummary-1;y>z;y--)
						ReportDate[di].MostCasesIndex[y] = ReportDate[di].MostCasesIndex[y-1];
					ReportDate[di].MostCasesIndex[z] = x;
					break;
				}
			}

			for(z=0;z<MaxSummary;z++)
			{
				if(Data.PerCapita > ReportDate[di].Data[ReportDate[di].MostPerCapitaIndex[z]].PerCapita)
				{
					for(y=MaxSummary-1;y>z;y--)
						ReportDate[di].MostPerCapitaIndex[y] = ReportDate[di].MostPerCapitaIndex[y-1];
					ReportDate[di].MostPerCapitaIndex[z] = x;
					break;
				}
			}
		}

		ReportDate[di].Prepped = true;

		/*
		console.log("For index " + DateIndex + " Dated " + ReportDate[DateIndex].Date);
		for(y=0;y<MaxSummary;y++)
		{
			console.log("Rank: " + y + " Cases is " + ReportDate[DateIndex].Data[ReportDate[DateIndex].MostCasesIndex[y]].Adm + ", " + ReportDate[DateIndex].Data[ReportDate[DateIndex].MostCasesIndex[y]].Prov);
			console.log(" with " + ReportDate[DateIndex].Data[ReportDate[DateIndex].MostCasesIndex[y]].Cases + " cases");
			console.log("Rank: " + y + " Cases per capita is " + ReportDate[DateIndex].Data[ReportDate[DateIndex].MostPerCapitaIndex[y]].Adm + ", " + ReportDate[DateIndex].Data[ReportDate[DateIndex].MostPerCapitaIndex[y]].Prov);
			console.log(" with " + ReportDate[DateIndex].Data[ReportDate[DateIndex].MostPerCapitaIndex[y]].PerCapita + " per capita cases");
		}
		*/
	}
}


function DrawCaseData()
{
	var Lat,Lng,c,x;
	// ctx.strokeStyle = "#000000";
	// ctx.globalAlpha = 1.0;
	ctx.lineWidth = 1;
	var MaxCases = 0;
	var s = 5;

	for(x=0;x<ReportDate[DateIndex].Data.length;x++)
	{
		if(ReportDate[DateIndex].Data[x].ScaledCases > MaxCases)
			MaxCases = ReportDate[DateIndex].Data[x].ScaledCases;
	}
	for(x=0;x<ReportDate[DateIndex].Data.length;x++)
	{
		var Data = ReportDate[DateIndex].Data[x];

		c = Math.floor(Data.ScaledCases/4);
		// console.log("C = " + c);
		if((Data.ScaledCases > 1) && (c == 0))
			c = 1;
		if(c >= SeverityColors.length)
			c = SeverityColors.length-1;
		ctx.fillStyle = SeverityColors[c];
		ctx.strokeStyle = SeverityColors[c];
		Lat = MapToCanvasY(Data.Lat);
		Lng = MapToCanvasX(Data.Long);

		var Alpha = 0.2 + (Data.ScaledCases / MaxCases);
		if(Alpha > 1.0)
			Alpha = 1.0;
		ctx.globalAlpha = Alpha;
		// ctx.globalAlpha = 1.0;
		ctx.beginPath();
		ctx.arc(Lng,Lat,s,0,2*Math.PI);
		ctx.fill();
		// ctx.stroke();
		ctx.closePath();
		/*	 old circles - were getting too large
		ctx.beginPath();
		ctx.arc(Lng,Lat,2+Math.floor(Data.ScaledCases/DrawScaleFactor),0,2*Math.PI);
		ctx.globalAlpha = 0.1;
		ctx.fill();
		ctx.globalAlpha = 0.5;
		ctx.stroke();
		ctx.closePath();
		*/
	}
	ctx.globalAlpha = 1.0;
}

function DrawDeathData()
{
	var Lat,Lng,d,x,c;
	ctx.strokeStyle = "#000000";
	ctx.globalAlpha = 0.3;
	// ctx.globalAlpha = 1.0;
	var s = 5;
	for(x=0;x<ReportDate[DateIndex].Data.length;x++)
	{
		var Data = ReportDate[DateIndex].Data[x];

		d = Data.Deaths;
		if(d > 1)
		{
			if(d > 1000)
				c = DeathSeverityColors.length-1;
			else
				if(d > 500)
					c = DeathSeverityColors.length-2;
				else
					if(d > 100)
						c = DeathSeverityColors.length-3;
					else
						if(d > 10)
							c = DeathSeverityColors.length-4;
						else
							c = 0;

			ctx.fillStyle = DeathSeverityColors[c];
			Lat = MapToCanvasY(Data.Lat);
			Lng = MapToCanvasX(Data.Long);
			// ctx.globalAlpha = 1.0;
			ctx.beginPath();
			ctx.arc(Lng,Lat,s,0,2*Math.PI);
			ctx.fill();
			// ctx.stroke();
			ctx.closePath();
			/*
			ctx.beginPath();
			ctx.arc(Lng,Lat,2+Math.floor(Data.ScaledCases/DrawScaleFactor),0,2*Math.PI);
			ctx.fill();
			// ctx.stroke();
			ctx.closePath();
			*/
		}
	}
}

function DrawPerCapitaData()
{
	var Lat,Lng,c,x,i,h,s;
	ctx.strokeStyle = "#000000";
	ctx.globalAlpha = 0.5;
	s = 5;
	var a = ReportDate[DateIndex].Data.sort(function(a,b) {return a.PerCapita - b.PerCapita});
	for(x=0;x<a.length;x++)
	{
		var Data = a[x];

		if(Data.PerCapita == 0)
			continue;
		else
		{
			i = Math.floor(Math.pow(Data.PerCapita * 10000,2));
			if(i > 127)
			{
				h = DecToHex(255 - (i>255?255:i));
				c = "#" + h + "0000";
			}
			else
			{
				h = DecToHex(255 - Math.floor(i*2.5));
				c = "#ff" + h + h;
			}
			ctx.fillStyle = c;
		}
		Lat = MapToCanvasY(Data.Lat);
		Lng = MapToCanvasX(Data.Long);
		// ctx.fillRect(Lng,Lat,s,s);
		ctx.beginPath();
		ctx.arc(Lng,Lat,s,0,2*Math.PI);
		ctx.fill();
		// ctx.stroke();
		ctx.closePath();
	}
}

function DrawDeathsPerCapitaData()
{
	var Lat,Lng,c,x,i,h,s;
	ctx.strokeStyle = "#000000";
	ctx.globalAlpha = 0.5;
	s = 5;
	var a = ReportDate[DateIndex].Data.sort(function(a,b) {return a.DeathsPerCapita - b.DeatsPerCapita});
	for(x=0;x<a.length;x++)
	{
		var Data = a[x];

		if(Data.DeathsPerCapita == 0)
			continue;
		else
		{
			i = Math.floor(Math.pow(Data.PerCapita * 10000,2));
			if(i > 127)
			{
				h = DecToHex(255 - (i>255?255:i));
				c = "#" + h + "0000";
			}
			else
			{
				h = DecToHex(255 - Math.floor(i*2.5));
				c = "#ff" + h + h;
			}
			ctx.fillStyle = c;
		}
		Lat = MapToCanvasY(Data.Lat);
		Lng = MapToCanvasX(Data.Long);
		// ctx.fillRect(Lng,Lat,s,s);
		ctx.beginPath();
		ctx.arc(Lng,Lat,s,0,2*Math.PI);
		ctx.fill();
		// ctx.stroke();
		ctx.closePath();
	}
}

function DrawCaseDeathRateData()
{
	var Lat,Lng,c,x,i,h,s;
	ctx.strokeStyle = "#000000";
	ctx.globalAlpha = 1.0;
	s = 5;
	var a = ReportDate[DateIndex].Data.sort(function(a,b) {return a.DeathRate - b.DeathRate});
	for(x=0;x<a.length;x++)
	{
		var Data = a[x];

		if(Data.DeathRate == 0)
			continue;
		else
		{
			// console.log("r = " + Data.DeathRate);
			if(Data.DeathRate > 0.3)
				c = DeathSeverityColors.length-1;
			else
				if(Data.DeathRate > 0.1)
					c = DeathSeverityColors.length-2;
				else
					if(Data.DeathRate > 0.05)
						c = DeathSeverityColors.length-3;
					else
						if(Data.DeathRate > 0.001)
							c = DeathSeverityColors.length-4;
						else
							c = 0;

			ctx.fillStyle = DeathRateColors[c];
		}
		Lat = MapToCanvasY(Data.Lat);
		Lng = MapToCanvasX(Data.Long);
		// ctx.fillRect(Lng,Lat,s,s);
		ctx.beginPath();
		ctx.arc(Lng,Lat,s,0,2*Math.PI);
		ctx.fill();
		// ctx.stroke();
		ctx.closePath();
	}
}

function DrawCaseByGeo()
{
	var Lat,Lng,c,x,y,i,z;
	var SizeX,SizeY;

	ctx.fillStyle = "#000000";
	ctx.strokeStyle = "#000000";
	ctx.lineWidth = 1;
	ctx.globalAlpha = 0.2;

	/*
	// draw lat/long lines and labels
	ctx.font = "8px Courier";
	for(y=MinLat;y<=MaxLat;y++)
	{
		ctx.fillText(y,8,MapToCanvasY(y));
		ctx.beginPath();
		ctx.moveTo(MapToCanvasX(MinLng),MapToCanvasY(y));
		ctx.lineTo(MapToCanvasX(MaxLng),MapToCanvasY(y));
		ctx.stroke();
		ctx.closePath();
	}

	for(x=MinLng;x<=MaxLng;x++)
	{
		ctx.fillText(x,MapToCanvasX(x),(x%2)?8:14);
		ctx.beginPath();
		ctx.moveTo(MapToCanvasX(x),MapToCanvasY(MinLat));
		ctx.lineTo(MapToCanvasX(x),MapToCanvasY(MaxLat));
		ctx.stroke();
		ctx.closePath();
		// console.log("x = " + MapToCanvasX(x) + " y = " + MapToCanvasY(y));
	}
	*/

	SizeX = MapToCanvasX(MinLng) - MapToCanvasX(MinLng-1);
	SizeY = MapToCanvasY(MinLat) - MapToCanvasY(MinLat+1);
	ctx.globalAlpha = 0.5;
	for(x=MinLng;x<=MaxLng;x++)
	{
		for(y=MinLat;y<=MaxLat;y++)
		{
			z = ReportDate[DateIndex].CaseMap[MapToHeatMapX(x)][MapToHeatMapY(y)];
			/*
			ctx.fillStyle = "#000000";
			ctx.fillText(z,MapToCanvasX(x),MapToCanvasY(y)+8);
			*/

			if(z != 0)
			{
				i = Math.floor(Math.sqrt(z));
				if(i > 64)
				{
					h = DecToHex(255 - (i>255?255:i));
					c = "#" + h + "0000";
				}
				else
				{
					if(i > 32)
					{
						// h = DecToHex(255 - Math.floor(i*2.0));
						h = DecToHex(255 - Math.floor(i*4.0));
						c = "#ff" + h + h;
					}
					else
					{
						h = DecToHex(255 - Math.floor(i*2.0));
						c = "#ff" + h + h;
						// c = "#ff80 " + h;
					}
				}
				ctx.fillStyle = c;

				ctx.fillRect(MapToCanvasX(x),MapToCanvasY(y),SizeX,SizeY);
			}
		}
	}
}

function DrawPerCapitaByGeo()
{
	var Lat,Lng,c,x,y,i,z;
	var Cases,Pop;
	var SizeX,SizeY;

	ctx.fillStyle = "#000000";
	ctx.strokeStyle = "#000000";
	ctx.lineWidth = 1;
	ctx.globalAlpha = 0.4;

	SizeX = MapToCanvasX(MinLng) - MapToCanvasX(MinLng-1);
	SizeY = MapToCanvasY(MinLat) - MapToCanvasY(MinLat+1);
	ctx.globalAlpha = 0.5;
	for(x=MinLng;x<=MaxLng;x++)
	{
		for(y=MinLat;y<=MaxLat;y++)
		{
			Pop = ReportDate[DateIndex].PopMap[MapToHeatMapX(x)][MapToHeatMapY(y)];
			Cases = ReportDate[DateIndex].CaseMap[MapToHeatMapX(x)][MapToHeatMapY(y)];
			if(Pop != 0)
			{
				// z = ReportDate[DateIndex].CaseMap[MapToHeatMapX(x)][MapToHeatMapY(y)] / ReportDate[DateIndex].PopMap[MapToHeatMapX(x)][MapToHeatMapY(y)];
				// z = Math.floor(ReportDate[DateIndex].PopMap[MapToHeatMapX(x)][MapToHeatMapY(y)] / 1000);
				// z = Math.floor(ReportDate[DateIndex].CaseMap[MapToHeatMapX(x)][MapToHeatMapY(y)] / 1000);
				z = Cases / Pop;
				// ctx.fillStyle = "#000000";
				// ctx.fillText(z,MapToCanvasX(x),MapToCanvasY(y)+8);

				i = Math.floor(Math.pow(z * 10000,2));
				if(i > 127)
				{
					h = DecToHex(255 - (i>255?255:i));
					c = "#" + h + "0000";
				}
				else
				{
					h = DecToHex(255 - Math.floor(i*2.5));
					c = "#ff" + h + h;
				}
				ctx.fillStyle = c;
				Lat = MapToCanvasY(y);
				Lng = MapToCanvasX(x);
				ctx.fillRect(Lng,Lat,SizeX,SizeY);
			}
		}
	}
}

function DrawData()
{
	var x;

	switch(DisplayIndex)
	{
		case	0:	// case data
					DrawCaseData();
					break;
		case	1:	// Deaths per county
					DrawDeathData();
					break;
		case	2:	// per capita data
					DrawPerCapitaData();
					break;
		case	3:	// Deaths Per Capita per county
					DrawDeathsPerCapitaData();
					break;
		case	4:	// Case Death Rate
					DrawCaseDeathRateData();
					break;
		case	5:	// case by geography
					DrawCaseByGeo();
					break;
		case	6:	// per capita by geography
					DrawPerCapitaByGeo();
					break;
	}
}

function XYChart(TopLeft, SizeXY, XEmphasis, XYLabels, ValueSeries1, ValueSeries2)
{
	var x,y;
	var Max = 0;
	var XScale,YScale;
	var GrowthPercent;

	for(x=0;x<ValueSeries1.length;x++)
	{
		if(Max < ValueSeries1[x])
			Max = ValueSeries1[x];
		if(Max < ValueSeries2[x])
			Max = ValueSeries2[x];
	}

	YScale = SizeXY[1] / Max;
	XScale = SizeXY[0] / (ValueSeries1.length-1);	// subtract 1 because Y axis is first point on scale

	ctx.globalAlpha = 1.0;
	ctx.strokeStyle = "black";
	ctx.lineWidth = 2;
	ctx.textAlign = "center";
	ctx.textBaseline = "bottom";

	ctx.beginPath();
	ctx.moveTo(TopLeft[0],TopLeft[1]);
	ctx.lineTo(TopLeft[0],TopLeft[1]+SizeXY[1]);
	ctx.lineTo(TopLeft[0]+SizeXY[0],TopLeft[1]+SizeXY[1]);
	// ctx.closePath();
	ctx.stroke();
	ctx.lineWidth = 1;
	ctx.font = "normal 6pt Courier";
	ctx.strokeText(XYLabels[0],TopLeft[0]+(SizeXY[0]/2),TopLeft[1]+SizeXY[1]+20);
	ctx.strokeText(Max,TopLeft[0]+8,TopLeft[1]);
	for(x=0;x<=ValueSeries1.length-1;x++)
	{
		if(x == XEmphasis)
		{
			ctx.globalAlpha = 1.0;
			ctx.strokeStyle = "green";
		}
		else
		{
			ctx.globalAlpha = 0.5;
			ctx.strokeStyle = "gray";
		}
		ctx.beginPath();
		ctx.moveTo(TopLeft[0]+(XScale*x),TopLeft[1]);
		ctx.lineTo(TopLeft[0]+(XScale*x),TopLeft[1]+SizeXY[1]);
		ctx.stroke();
		if((x % 10) == 0)
		{
			ctx.globalAlpha = 1.0;
			ctx.strokeStyle = "black";
			ctx.strokeText(x,TopLeft[0]+(XScale*x),TopLeft[1]+SizeXY[1]+10);
		}
	}
	
	// draw series1 shape and fill
	ctx.globalAlpha = 0.5;
	ctx.strokeStyle = "darkred";
	ctx.fillStyle = "darkred";
	ctx.beginPath();
	//ctx.moveTo(TopLeft[0],TopLeft[1]+(SizeXY[1]-ValueSeries1[0]));
	ctx.moveTo(TopLeft[0],TopLeft[1]+(SizeXY[1]-(ValueSeries1[0]*YScale)));
	for(x=1;x<ValueSeries1.length;x++)
		ctx.lineTo(TopLeft[0]+(XScale*x),TopLeft[1]+(SizeXY[1]-(ValueSeries1[x]*YScale)));
	ctx.lineTo(TopLeft[0]+SizeXY[0],TopLeft[1]+SizeXY[1]);
	ctx.lineTo(TopLeft[0],TopLeft[1]+SizeXY[1]);
	ctx.stroke();
	ctx.closePath();
	ctx.fill();

	// draw series1 growth shapes and fill **_**
	ctx.globalAlpha = 0.5;
	// console.log("---");
	for(x=1;x<ValueSeries1.length;x++)
	{
		if(ValueSeries1[x-1] == 0)
			ctx.fillStyle = "gray";
		else
		{
			GrowthPercent = Number((ValueSeries1[x] - ValueSeries1[x-1]) / ValueSeries1[x-1]);
			if(GrowthPercent > 0.2)
				ctx.fillStyle = GrowthRateColors[5];
			else
				if(GrowthPercent > 0.1)
					ctx.fillStyle = GrowthRateColors[4];
				else
					if(GrowthPercent > 0.05)
						ctx.fillStyle = GrowthRateColors[3];
					else
						if(GrowthPercent > 0.01)
							ctx.fillStyle = GrowthRateColors[2];
						else
							if(GrowthPercent > 0.001)
								ctx.fillStyle = GrowthRateColors[1];
							else
								if(GrowthPercent < 0)
									ctx.fillStyle = "gray";	// invalid data
								else
									ctx.fillStyle = GrowthRateColors[0];
			// console.log("Growth percent = " + GrowthPercent + " fillstyle = " + ctx.fillStyle);
		}
		ctx.beginPath();
		ctx.moveTo(TopLeft[0]+(XScale*(x-1)),TopLeft[1]+(SizeXY[1]-(ValueSeries1[x-1]*YScale)));
		ctx.lineTo(TopLeft[0]+(XScale*x),TopLeft[1]+(SizeXY[1]-(ValueSeries1[x]*YScale)));
		ctx.lineTo(TopLeft[0]+(XScale*x),TopLeft[1]);
		ctx.lineTo(TopLeft[0]+(XScale*(x-1)),TopLeft[1]);
		ctx.lineTo(TopLeft[0]+(XScale*(x-1)),TopLeft[1]+(SizeXY[1]-(ValueSeries1[x-1]*YScale)));
		ctx.closePath();
		ctx.fill();
	}

	// draw series2 shape and fill
	ctx.globalAlpha = 0.5;
	ctx.strokeStyle = "white";
	ctx.fillStyle = "black";
	ctx.beginPath();
	// ctx.moveTo(TopLeft[0],TopLeft[1]+(SizeXY[1]-ValueSeries2[0]));
	ctx.moveTo(TopLeft[0],TopLeft[1]+(SizeXY[1]-(ValueSeries2[0]*YScale)));
	for(x=1;x<ValueSeries2.length;x++)
		ctx.lineTo(TopLeft[0]+(XScale*x),TopLeft[1]+(SizeXY[1]-(ValueSeries2[x]*YScale)));
	ctx.lineTo(TopLeft[0]+SizeXY[0],TopLeft[1]+SizeXY[1]);
	ctx.lineTo(TopLeft[0],TopLeft[1]+SizeXY[1]);
	ctx.stroke();
	ctx.closePath();
	ctx.fill();

	ctx.textAlign = "left";
	ctx.textBaseline = "bottom";
}

function Pie(CenterX, CenterY, Radius, Amounts, Labels)
{
	var x,y;
	var cx,cy;
	var lx,ly;
	var Total = 0;
	var Percents = [];
	var Radians = [];
	var LineWidth = 20;
	var RadiansSoFar = 0;
 
	var Color1 = "#7878A0";
	var Color2 = "#404080";
	var Color3 = "#9090C0";
 
	for(x=0;x<Amounts.length;x++)
	{
		Total += Amounts[x];
	}

	if(Total == 0)
	{
		ctx.textAlign = "center";
		ctx.textBaseline = "bottom";
		ctx.fillStyle = "10px Courier black";
		ctx.fillText("(No data to report)",CenterX,CenterY);
		ctx.textAlign = "left";
		ctx.textBaseline = "bottom";
		return;
	}
 
	for(x=0;x<Amounts.length;x++)
	{
		Percents[x] = Amounts[x] / Total;
	}
 
	for(x=0;x<Amounts.length;x++)
	{
		Radians[x] = Percents[x] * (Math.PI * 2);
	}
 
	// ctx.font = "normal 8pt Courier";
	// ctx.setBaseline = "top";
	// ctx.textBaseline="middle";
	ctx.textAlign = "center";
	ctx.textBaseline = "bottom";
	for(x=0;x<Amounts.length;x++)
	{
		// draw arc of graph
		// ctx.fillStyle = ctx.strokeStyle = x==0?Color3:(x%2)==1?Color1:Color2;
		ctx.strokeStyle = ctx.fillStyle = CountyColors[x];
		ctx.beginPath();
		ctx.lineWidth = LineWidth;
		ctx.arc(CenterX,CenterY,Radius,RadiansSoFar,RadiansSoFar + Radians[x]);
		ctx.stroke();
 
		// draw label line and label
		ctx.beginPath();
		ctx.lineWidth = 2;
		lx = cx = CenterX + (Radius * Math.cos(RadiansSoFar+(Radians[x]/2)));
		ly = cy = CenterY + (Radius * Math.sin(RadiansSoFar+(Radians[x]/2)));
		ctx.moveTo(cx,cy);
		cx = CenterX + ((Radius+10) * Math.cos(RadiansSoFar+(Radians[x]/2)));
		cy = CenterY + ((Radius+10) * Math.sin(RadiansSoFar+(Radians[x]/2)));
		ctx.lineTo(cx,cy);
		ctx.stroke();

		// Draw separating line
		/*
		ctx.beginPath();
		ctx.strokeStyle = "white";
		ctx.lineWidth = 5;
		cx = CenterX+((Radius * Math.cos(RadiansSoFar+Radians[x]))*1.2);
		cy = CenterY+((Radius * Math.sin(RadiansSoFar+Radians[x]))*1.2);
		ctx.moveTo(CenterX,CenterY);
		ctx.lineTo(cx,cy);
		ctx.stroke();
		*/

		RadiansSoFar += Radians[x];
	}

	// draw labels on top of pie segments
	RadiansSoFar = 0;
	ctx.lineWidth = 1;
	ctx.fillStyle = "black";
	ctx.strokeStyle = "white";
	for(x=0;x<Amounts.length;x++)
	{
		cx = CenterX + ((Radius+10) * Math.cos(RadiansSoFar+(Radians[x]/2)));
		cy = CenterY + ((Radius+10) * Math.sin(RadiansSoFar+(Radians[x]/2)));
		ctx.strokeText(Labels[x],cx,cy);
		ctx.fillText(Labels[x],cx,cy);
		RadiansSoFar += Radians[x];
	}

	// draw total amount in center
	ctx.fillStyle = "black";
	ctx.strokeStyle = "white";
	ctx.strokeText(Total,CenterX,CenterY);
	ctx.fillText(Total,CenterX,CenterY);

	ctx.textAlign = "left";
	ctx.textBaseline = "bottom";
}

function UpdateClickData(mx,my)
{
	var x,y,z;
	var cx,cy;
	var Sort = 0;
	var MinSevereArea1X = SevereClickArea1[0] - SevereClickArea1Radius;
	var MaxSevereArea1X = SevereClickArea1[0] + SevereClickArea1Radius;
	var MinSevereArea1Y = SevereClickArea1[1] - SevereClickArea1Radius;
	var MaxSevereArea1Y = SevereClickArea1[1] + SevereClickArea1Radius;
	var MinSevereArea2X = SevereClickArea2[0] - SevereClickArea2Radius;
	var MaxSevereArea2X = SevereClickArea2[0] + SevereClickArea2Radius;
	var MinSevereArea2Y = SevereClickArea2[1] - SevereClickArea2Radius;
	var MaxSevereArea2Y = SevereClickArea2[1] + SevereClickArea2Radius;

	ClickData.length = 0;

	if(	(mx > MinSevereArea1X) &&
		(mx < MaxSevereArea1X) &&
		(my > MinSevereArea1Y) &&
		(my < MaxSevereArea1Y))
	{
		for(x=0;x<MaxSummary;x++)
		{
			var Data = ReportDate[DateIndex].Data[ReportDate[DateIndex].MostCasesIndex[x]];
			Data.HistoryData = new Array(ReportDate.length);
			ClickData[ClickData.length] = Data;
		}
		Sort = 0;
		ClickDataCategory = 1;
	}
	else
	{
		if(	(mx > MinSevereArea2X) &&
			(mx < MaxSevereArea2X) &&
			(my > MinSevereArea2Y) &&
			(my < MaxSevereArea2Y))
		{
			for(x=0;x<MaxSummary;x++)
			{
				var Data = ReportDate[DateIndex].Data[ReportDate[DateIndex].MostPerCapitaIndex[x]];
				Data.HistoryData = new Array(ReportDate.length);
				ClickData[ClickData.length] = Data;
			}
			Sort = 0;
			ClickDataCategory = 2;
		}
		else
		{
			for(x=0;x<ReportDate[DateIndex].Data.length;x++)
			{
				var Data = ReportDate[DateIndex].Data[x];
	
				cx = MapToCanvasX(Data.Long);
				cy = MapToCanvasY(Data.Lat);
				if(	(cx > (mx - Tolerance)) &&
					(cx < (mx + Tolerance)) &&
					(cy > (my - Tolerance)) &&
					(cy < (my + Tolerance)))
				{
					if(ClickData.length == MaxSummary)
						break;
	
					Data.HistoryData = new Array(ReportDate.length);	// for tying clickdata to other dates for graphs
		
					ClickData[ClickData.length] = Data;
				}
			}
			Sort = 1;
			ClickDataCategory = 0;
		}
	}

	// now that we have the relevant counties, we need to tie all historical dates to it
	for(z=0;z<ClickData.length;z++)
	{
		for(x=0;x<ReportDate.length;x++)
		{
			for(y=0;y<ReportDate[x].Data.length;y++)
			{
				if((ReportDate[x].Data[y].FIPS == ClickData[z].FIPS)||	// some counties (particularly in CA and TX) were not reporing the same FIPS code consistently
				((ReportDate[x].Data[y].Lat == ClickData[z].Lat) && (ReportDate[x].Data[y].Long == ClickData[z].Long)))
				{
					ClickData[z].HistoryData[x] = ReportDate[x].Data[y];
					break;
				}
			}
		}
	}

	if(Sort)
		ClickData.sort(function(a,b) { return(a.Adm.localeCompare(b.Adm)); });
}

function MouseDown(Event)
{
	var mx,my;

	mx = Event.pageX;
	my = Event.pageY;
	mx -= canvas.offsetLeft;
	my -= canvas.offsetTop;

	LastClickedX = mx;
	LastClickedY = my;

	UpdateClickData(mx,my);
	ClearScreen();
	// DrawUSAMap();
	DrawClickData();
	DrawData();
	DrawClickDataCounties();
	DrawUSAMap();
}

function DrawClickData()
{
	var FontSize;
	var dx,dy;
	var x,y;
	var z;
	var StatColumn = 100;
	var ChartColumn = 150;
	var Amounts = [];
	var Labels = [];
	var ChartCases = [];
	var ChartFatalities = [];

	dx = RightDrawAreaStart;
	dy = 100;
	FontSize = 10;
	// ctx.fillStyle = "darkgray";
	ctx.fillStyle = "white";
	ctx.fillRect(RightDrawAreaStart,0,canvas.width-RightDrawAreaStart,canvas.height);
	ctx.textAlign = "left";
	ctx.textBaseline = "middle";
	if(ClickData.length == 0)
	{
		ctx.font = "normal 12px Courier";
		ctx.fillStyle = "black";
		ctx.fillText("No county data here",dx,dy);
	}
	else
	{
		// pie charts
		ctx.font = "normal 12px Courier";
		ctx.fillStyle = "blue";
		ctx.fillText("Geo " + Math.floor(ClickData[0].Lat) + " by " + Math.floor(ClickData[0].Long) + "(" + ClickData[0].Prov + ")",dx-20,dy);

		dy += 16;
		// ctx.fillText("Date " + ReportDate[DateIndex].Date,dx,dy);

		dy += 16;
		ctx.font = "normal 12px Courier";
		ctx.textAlign = "center";
		ctx.fillStyle = "black";
		ctx.fillText("Case Distribution",dx+60,dy);
		ctx.textAlign = "left"

		for(x=0;x<ClickData.length;x++)
		{
			Amounts[x] = ClickData[x].Cases;
			Labels[x] = ClickData[x].Adm;
		}

		dy += 80;
		Pie(dx+60,dy,60,Amounts,Labels);

		for(x=0;x<ClickData.length;x++)
			Amounts[x] = ClickData[x].Deaths;

		dy += 110;
		ctx.font = "normal 12px Courier";
		ctx.fillStyle = "black";
		ctx.textAlign = "center";
		ctx.fillText("Fatality distribution",dx+60,dy);
		ctx.textAlign = "left";

		dy += 80;
		Pie(dx+60,dy,60,Amounts,Labels);

		// Detailed stats
		dx = 30;
		for(x=0;x<ClickData.length;x++)
		{
			dy = BottomDrawAreaStart;
			ctx.globalAlpha = 1.0;
			ctx.font = "normal 12px Courier";
			// ctx.fillStyle = "blue";
			ctx.fillStyle = CountyColors[x];
			if(ClickData[x].SqMi!= 0)
			{
				if(ClickData[x].Prov.localeCompare("Louisiana") == 0)
					ctx.fillText(ClickData[x].Adm + " Parish",dx,dy);
				else
					ctx.fillText(ClickData[x].Adm + " County",dx,dy);
			}
			else
					ctx.fillText(ClickData[x].Adm,dx,dy);

			dy += FontSize;
			ctx.font = "normal 8px Courier";
			ctx.fillStyle = "gray";
			ctx.fillText(ClickData[x].Prov,dx,dy);
			if(ClickData[x].Pop!= 0)
			{
				dy += FontSize;
				ctx.fillStyle = "green";
				ctx.fillText("Pop:",dx,dy);
				ctx.fillText(ClickData[x].Pop,dx+StatColumn,dy);
			}
			if(ClickData[x].SqMi!= 0)
			{
				dy += FontSize;
				ctx.fillText("Square Miles:",dx,dy);
				ctx.fillText(ClickData[x].SqMi,dx+StatColumn,dy);
			}
			dy += FontSize;
			ctx.fillStyle = "black";
			ctx.fillText("Cases:",dx,dy);
			ctx.fillStyle = "darkred";
			ctx.fillText(ClickData[x].Cases,dx+StatColumn,dy);
			dy += FontSize;
			ctx.fillStyle = "black";
			ctx.fillText("Deaths:",dx,dy);
			ctx.fillStyle = "darkred";
			ctx.fillText(ClickData[x].Deaths,dx+StatColumn,dy);
			/*  // recovered data is always 0 in JH data.. (shrug..)
			dy += FontSize;
			ctx.fillStyle = "black";
			ctx.fillText("Recovered:",dx,dy);
			ctx.fillStyle = "darkred";
			ctx.fillText(ClickData[x].Recovered,dx+StatColumn,dy);
			*/
			if(ClickData[x].Pop!= 0)
			{
				dy += FontSize;
				ctx.fillStyle = "black";
				ctx.fillText("Cases Per Capita:",dx,dy);
				ctx.fillStyle = "darkred";
				z = (ClickData[x].PerCapita * 100).toFixed(3);
				ctx.fillText(z + "%",dx+StatColumn,dy);
				dy += FontSize;
				ctx.fillStyle = "black";
				ctx.fillText("Deaths Per Capita:",dx,dy);
				ctx.fillStyle = "darkred";
				z = (ClickData[x].DeathsPerCapita * 100).toFixed(3);
				ctx.fillText(z + "%",dx+StatColumn,dy);
				dy += FontSize;
				ctx.fillStyle = "black";
				ctx.fillText("Death Rate:",dx,dy);
				ctx.fillStyle = "darkred";
				z = (ClickData[x].DeathRate * 100).toFixed(3);
				ctx.fillText(z + "%",dx+StatColumn,dy);
			}

			dy += 5;
			if(ClickData[x].Pop!= 0)
			{
				// XYChart(TopLeft, SizeXY, XEmphasis, XYLabels, ValueSeries1, ValueSeries2)
				ChartCases.length = 0;
				ChartFatalities.length = 0;
				for(y=0;y<ClickData[x].HistoryData.length;y++)
				{
					if(ClickData[x].HistoryData[y])
					{
						ChartCases[y] = ClickData[x].HistoryData[y].Cases;
						ChartFatalities[y] = ClickData[x].HistoryData[y].Deaths;
					}
					else
					{
						ChartCases[y] = 0;
						ChartFatalities[y] = 0;
					}
				}
				XYChart([dx+ChartColumn,dy-(FontSize*9)],[110,90],DateIndex,["Days since 3/22",""],ChartCases,ChartFatalities);
			}

			dx += DetailedStatsSpacing;
		}
	}	
	ctx.textAlign = "left";
	ctx.textBaseline = "bottom";
}

function DrawClickDataCounties()
{
	var x;

	// Draw selected counties
	ctx.globalAlpha = 1.0;
	if(ClickData.length != 0)
	{
		for(x=0;x<ClickData.length;x++)
		{
			ctx.fillStyle = CountyColors[x];
			ctx.strokeStyle = "black";
			ctx.LineWidth = 4;
			ctx.beginPath();
			ctx.moveTo(MapToCanvasX(ClickData[x].Long),MapToCanvasY(ClickData[x].Lat));
			ctx.lineTo(MapToCanvasX(ClickData[x].Long)-Tolerance,MapToCanvasY(ClickData[x].Lat)+Tolerance);
			ctx.lineTo(MapToCanvasX(ClickData[x].Long)+Tolerance,MapToCanvasY(ClickData[x].Lat)+Tolerance);
			ctx.lineTo(MapToCanvasX(ClickData[x].Long),MapToCanvasY(ClickData[x].Lat));
			ctx.closePath();
			// ctx.stroke();
			ctx.fill();
			// ctx.fillRect(MapToCanvasX(ClickData[x].Long)-(Tolerance/2),MapToCanvasY(ClickData[x].Lat)-(Tolerance/2),Tolerance,Tolerance);
		}
	}
	ctx.font = "italic 12px Courier";
	ctx.fillStyle = "black";
	ctx.textAlign = "left";
	ctx.textBaseline = "middle";
	ctx.fillText("Data Sources: Johns Hopkins University, United States Census",10,10);
	ctx.font = "normal 16px Courier";
	ctx.fillStyle = "black";
	ctx.fillText(DisplayOptions[DisplayIndex] + ", " + ReportDate[DateIndex].Date, MapTitleLocation[0], MapTitleLocation[1]);
	ctx.font = "normal 10px Courier";
	ctx.fillStyle = "white";
	ctx.fillText("Click on map for county level detail or", MapTitleLocation[0], MapTitleLocation[1]+24);
}

var ClickData = [];
var ClickDataCategory;
var Tolerance = 10;
var RightDrawAreaStart = 1020;
var BottomDrawAreaStart = 500;
var LastClickedX = 0;
var LastClickedY = 0;
var DetailedStatsSpacing = 280;
var CountyColors = [ "#1c1a6e","#696e1a","#1a6e28","#1b6769","#645c65","#ba4a00" ];
var SeverityColors = [ "#c0c0c0", "#ff6a1f", "#ba4000", "#ff0000" ];
// var SeverityColors = [ "#c0c0c0", "c0c080", "c0c040", "c0c000", "e0e000", "f0f000", "f0c000", "f0a000", "f08000", "f04000", "ff0000" ];
var DeathSeverityColors = [ "#c0c0c0", "#ff6a1f", "#ba4000", "#ff4000", "#ff0000" ];
var DeathRateColors = [ "#c0c0c0", "#a0a0a0", "#808080", "#404040", "#000000" ];
var GrowthRateColors = [ "#ffffff", "#ffc0c0", "#ffa090", "#ff7050", "#ff3600", "#ff0000" ];
var canvas = document.getElementById("USAMap");
var ctx = canvas.getContext("2d");
var DrawScaleFactor = 2;
var DateIndex = ReportDate.length-1;	// Start with latest date in set
var DisplayOptions = [ 
							"Cases Per County", 						// 0
							"Deaths per County",						// 1
							"Cases Per Capita Per County", 				// 2
							"Deaths Per Capita Per County",				// 3
							"Case Death Rate Percentage By County",		// 4
							"Cases by Geographic Area", 				// 5
							"Cases Per Capita by Geographic Area"		// 6
					];
var DisplayIndex = 0;
var MaxSummary = 4;
var SevereClickArea1 = [];
SevereClickArea1[0] = 20;
SevereClickArea1[1] = 440;
SevereClickArea1Radius = 8;
var SevereClickArea2 = [];
SevereClickArea2[0] = 20;
SevereClickArea2[1] = 460;
SevereClickArea2Radius = 8;
var MapTitleLocation = [];
MapTitleLocation[0] = 10;
MapTitleLocation[1] = 390;

var xx,yy,zz;
for(zz=0;zz<ReportDate.length;zz++)
{
	ReportDate[zz].CaseMap = new Array(100);
	ReportDate[zz].PopMap = new Array(100);
	for(xx=0;xx<100;xx++)
	{
		ReportDate[zz].CaseMap[xx] = new Array(100);
		ReportDate[zz].PopMap[xx] = new Array(100);
		for(yy=0;yy<100;yy++)
		{
			ReportDate[zz].CaseMap[xx][yy] = 0;
			ReportDate[zz].PopMap[xx][yy] = 0;
		}
	}
}
			
for(x=0;x<ReportDate.length;x++)
	ReportDate[x].Prepped = false;

ClearScreen();
// DrawUSAMap();
PrepData();
UpdateClickData(SevereClickArea1[0],SevereClickArea1[1]);
DrawClickData();
DrawData();
DrawClickDataCounties();
DrawUSAMap();

var DateSlider = document.getElementById("DateCtrl");
var DateSet = document.getElementById("CurrentDateSet");
DateSlider.min = 0;
DateSlider.max = ReportDate.length-1;
DateSlider.value = DateIndex;
DateSet.innerHTML = ReportDate[DateIndex].Date;
DateSlider.oninput = function() 
{
	// console.log("Slider value = " + this.value);
	DateIndex = this.value;
	DateSet.innerHTML = ReportDate[DateIndex].Date;
	ClearScreen();
	// DrawUSAMap();
	// PrepData();
	if(ClickData.length != 0)
		UpdateClickData(LastClickedX, LastClickedY);
	DrawClickData();
	DrawData();
	DrawClickDataCounties();
	DrawUSAMap();
}

/*
var DisplaySlider = document.getElementById("DisplayCtrl");
DisplaySlider.min = 0;
DisplaySlider.max = DisplayOptions.length-1;
DisplaySlider.value = DisplayIndex;
var DisplaySet = document.getElementById("DisplaySet");
DisplaySet.innerHTML = DisplayOptions[DisplayIndex];
DisplaySlider.oninput = function()
{
	// console.log("Slider value = " + this.value);
	DisplayIndex = Number(this.value);
	DisplaySet.innerHTML = DisplayOptions[DisplayIndex];
	ClearScreen();
	DrawUSAMap();
	DrawClickData();
	DrawData();
	DrawClickDataCounties();
}
*/

var DisplaySelect = document.getElementById("DisplaySelect");
for(x=0;x<DisplayOptions.length;x++)
{
	var elem = document.createElement("option");
	elem.text = DisplayOptions[x];
	DisplaySelect.options.add(elem,x);
}
DisplaySelect.selectedIndex = DisplayIndex;
DisplaySelect.onchange = function()
{
	DisplayIndex = DisplaySelect.selectedIndex;
	ClearScreen();
	// DrawUSAMap();
	DrawClickData();
	DrawData();
	DrawClickDataCounties();
	DrawUSAMap();
}

// canvas.addEventListener("mousedown",MouseDown,false);
canvas.addEventListener("click",MouseDown,false);

</script>

</html>
