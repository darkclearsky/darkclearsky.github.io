<!DOCTYPE html>
<html>
<meta charset = "UTF-8">
<style type="text/css">
	.LText { font-family: Courier; font-size:16px; font-weight:bold; vertical-align: top; text-align: left; background-color: white; }
	.RText { font-family: Courier; font-size:16px; font-weight:bold; vertical-align: top; text-align: right; background-color: white; }
	.CText { font-family: Courier; font-size:16px; font-weight:bold; vertical-align: top; text-align: center; color: black; background-color: white; }
    .Table { display:table }
    .Row { display: table-row; background-color: white; height: 40px; }
    .Cell { display: table-cell; vertical-align: top; text-align: left; border: 0px solid black; padding-left: 5px; padding-right: 5px; }
    .CharCell { display: table-cell; column-span:2; vertical-align: top; border: 0px solid black; padding-left: 0px; padding-right: 0px; width:1000px}
</style>
<body>
<div class = "Table">
	<div class = "Row">
			<div class = "Cell" id="RefreshThis">
				<div class = "LText" id="DataDate">Loading...</div>
				<!-- <label class = "LText">Select State</label> -->
				<select hidden class="LText" id="CountrySelect"><option>Loading...</option></select>
			</div>
	</div>
	<div class = "Row">
		<div class = "ChartCell">
			<canvas id="ChartArea" width=1000 height=900 style="border:0px solid #ffffff; background-color:white;">
			Your browser does not support HTML5
			</canvas>
		</div>
	</div>
</div>

</body>

<script src=IntData_0.js></script>
<script src=IntData_1.js></script>
<script src=IntData_2.js></script>
<script src=IntData_3.js></script>
<script src=IntData_4.js></script>
<script src=IntData_5.js></script>
<script src=IntData_6.js></script>
<script src=IntData_7.js></script>
<script src=IntData_8.js></script>
<script src=IntData_9.js></script>
<script src=IntData_10.js></script>
<script src=IntData_11.js></script>
<script src=IntData_12.js></script>
<script src=IntData_13.js></script>
<script src=IntData_14.js></script>
<script src=IntData_15.js></script>
<script src=IntData_16.js></script>
<script src=IntData_17.js></script>
<script src=IntData_18.js></script>
<script src=IntData_19.js></script>
<script src=IntData_20.js></script>
<script src=IntData_21.js></script>
<script src=IntData_22.js></script>
<script src=IntData_23.js></script>
<script src=IntData_24.js></script>
<script src=IntData_25.js></script>
<script src=IntData_26.js></script>
<script src=IntData_27.js></script>
<script src=IntData_28.js></script>
<script src=IntData_29.js></script>
<script src=IntData_30.js></script>
<script src=IntData_31.js></script>
<script src=IntData_32.js></script>
<script src=IntData_33.js></script>
<script src=IntData_34.js></script>
<script src=IntData_35.js></script>
<script src=IntData_36.js></script>
<script src=IntData_37.js></script>
<script src=IntData_38.js></script>
<script src=IntData_39.js></script>
<script src=IntData_40.js></script>
<script src=IntData_41.js></script>
<script src=IntData_42.js></script>
<script src=IntData_43.js></script>
<script src=IntData_44.js></script>
<script src=IntData_45.js></script>
<script src=IntData_46.js></script>
<script src=IntData_47.js></script>
<script src=IntData_48.js></script>
<script src=IntData_49.js></script>
<script src=IntData_50.js></script>
<script src=IntData_51.js></script>
<script src=IntData_52.js></script>
<script src=IntData_53.js></script>
<script src=IntData_54.js></script>
<script src=IntData_55.js></script>
<script src=IntData_56.js></script>
<script src=IntData_57.js></script>
<script src=IntData_58.js></script>
<script src=IntData_59.js></script>
<script src=IntData_60.js></script>
<script src=IntData_61.js></script>
<script src=IntData_62.js></script>
<script src=IntData_63.js></script>
<script src=IntData_64.js></script>
<script src=IntData_65.js></script>
<script src=IntData_66.js></script>
<script src=IntData_67.js></script>
<script src=IntData_68.js></script>
<script src=IntData_69.js></script>
<script src=IntData_70.js></script>
<script src=IntData_71.js></script>
<script src=IntData_72.js></script>
<script src=IntData_73.js></script>
<script src=IntData_74.js></script>
<script src=IntData_75.js></script>
<script src=IntData_76.js></script>
<script src=IntData_77.js></script>
<script src=IntData_78.js></script>
<script src=IntData_79.js></script>
<script src=IntData_80.js></script>
<script src=IntData_81.js></script>
<script src=IntData_82.js></script>
<script src=IntData_83.js></script>
<script src=IntData_84.js></script>
<script src=IntData_85.js></script>
<script src=IntData_86.js></script>
<script src=IntData_87.js></script>
<script src=IntData_88.js></script>
<script src=IntData_89.js></script>
<script src=IntData_90.js></script>
<script src=IntData_91.js></script>
<script src=IntData_92.js></script>
<script src=IntData_93.js></script>
<script src=IntData_94.js></script>
<script src=IntData_95.js></script>
<script src=IntData_96.js></script>
<script src=IntData_97.js></script>
<script src=IntData_98.js></script>
<script src=IntData_99.js></script>
<script src=IntData_100.js></script>
<script src=IntData_101.js></script>
<script src=IntData_102.js></script>
<script src=IntData_103.js></script>
<script src=IntData_104.js></script>
<script src=IntData_105.js></script>
<script src=IntData_106.js></script>
<script src=IntData_107.js></script>
<script src=IntData_108.js></script>
<script src=IntData_109.js></script>
<script src=IntData_110.js></script>
<script src=IntData_111.js></script>
<script src=IntData_112.js></script>
<script src=IntData_113.js></script>
<script src=IntData_114.js></script>
<script src=IntData_115.js></script>
<script src=IntData_116.js></script>
<script src=IntData_117.js></script>
<script src=IntData_118.js></script>
<script src=IntData_119.js></script>
<script src=IntData_120.js></script>
<script src=IntData_121.js></script>
<script src=IntData_122.js></script>
<script src=IntData_123.js></script>
<script src=IntData_124.js></script>
<script src=IntData_125.js></script>
<script src=IntData_126.js></script>
<script src=IntData_127.js></script>
<script src=IntData_128.js></script>
<script src=IntData_129.js></script>
<script src=IntData_130.js></script>
<script src=IntData_131.js></script>
<script src=IntData_132.js></script>
<script src=IntData_133.js></script>
<script src=IntData_134.js></script>
<script src=IntData_135.js></script>
<script src=IntData_136.js></script>
<script src=IntData_137.js></script>
<script src=IntData_138.js></script>
<script src=IntData_139.js></script>
<script src=IntData_140.js></script>
<script src=IntData_141.js></script>
<script src=IntData_142.js></script>
<script src=IntData_143.js></script>
<script src=IntData_144.js></script>
<script src=IntData_145.js></script>
<script src=IntData_146.js></script>
<script src=IntData_147.js></script>
<script src=IntData_148.js></script>
<script src=IntData_149.js></script>
<script src=IntData_150.js></script>
<script src=IntData_151.js></script>
<script src=IntData_152.js></script>
<script src=IntData_153.js></script>
<script src=IntData_154.js></script>
<script src=IntData_155.js></script>
<script src=IntData_156.js></script>
<script src=IntData_157.js></script>
<script src=IntData_158.js></script>
<script src=IntData_159.js></script>
<script src=IntData_160.js></script>
<script src=IntData_161.js></script>
<script src=IntData_162.js></script>
<script src=IntData_163.js></script>
<script src=IntData_164.js></script>
<script src=IntData_165.js></script>
<script src=IntData_166.js></script>
<script src=IntData_167.js></script>
<script src=IntData_168.js></script>
<script src=IntData_169.js></script>
<script src=IntData_170.js></script>
<script src=IntData_171.js></script>
<script src=IntData_172.js></script>
<script src=IntData_173.js></script>
<script src=IntData_174.js></script>
<script src=IntData_175.js></script>
<script src=IntData_176.js></script>
<script src=IntData_177.js></script>
<script src=IntData_178.js></script>
<script src=IntData_179.js></script>
<script src=IntData_180.js></script>
<script src=IntData_181.js></script>
<script src=IntData_182.js></script>
<script src=IntData_183.js></script>
<script src=IntData_184.js></script>
<script src=IntData_185.js></script>
<script src=IntData_186.js></script>
<script src=IntData_187.js></script>
<script src=IntData_188.js></script>
<script src=IntData_189.js></script>
<script src=IntData_190.js></script>
<script src=IntData_191.js></script>
<script src=IntData_192.js></script>
<script src=IntData_193.js></script>
<script src=IntData_194.js></script>
<script src=IntData_195.js></script>
<script src=IntData_196.js></script>
<script src=IntData_197.js></script>
<script src=IntData_198.js></script>
<script src=IntData_199.js></script>
<script src=IntData_200.js></script>
<script src=IntData_201.js></script>
<script src=IntData_202.js></script>
<script src=IntData_203.js></script>
<script src=IntData_204.js></script>
<script src=IntData_205.js></script>
<script src=IntData_206.js></script>
<script src=IntData_207.js></script>
<script src=IntData_208.js></script>
<script src=IntData_209.js></script>
<script src=IntData_210.js></script>
<script src=IntData_211.js></script>
<script src=IntData_212.js></script>
<script src=IntData_213.js></script>
<script src=IntData_214.js></script>
<script src=IntData_215.js></script>
<script src=IntData_216.js></script>
<script src=IntData_217.js></script>
<script src=IntData_218.js></script>
<script src=IntData_219.js></script>
<script src=IntData_220.js></script>
<script src=IntData_221.js></script>
<script src=IntData_222.js></script>
<script src=IntData_223.js></script>
<script src=IntData_224.js></script>
<script src=IntData_225.js></script>
<script src=IntData_226.js></script>
<script src=IntData_227.js></script>
<script src=IntData_228.js></script>
<script src=IntData_229.js></script>
<script src=IntData_230.js></script>
<script src=IntData_231.js></script>
<script src=IntData_232.js></script>
<script src=IntData_233.js></script>
<script src=IntData_234.js></script>
<script src=IntData_235.js></script>
<script src=IntData_236.js></script>

<script>

function DecToHex(h)
{
	if(h < 0)
		return("00");
	if(h < 15)
		return("0" + h.toString(16));
	if(h > 255)
		return("ff");
	return(h.toString(16));
}

function ClearScreen()
{
	// clear canvas
	ctx.globalAlpha = 1.0;
	ctx.fillStyle = "white";
	ctx.fillRect(0,0,canvas.width,canvas.height);
}

function PrepData()
{
	var di,x,y,z;
	var TransLng,TransLat;

	for(di=0;di<ReportDate.length;di++)
	// if(!ReportDate[DateIndex].Prepped)
	{
		for(x=0;x<ReportDate[di].Data.length;x++)
		{
			var Data = ReportDate[di].Data[x];

			Data.Pop = Number(Data.Pop * 1000);	// UN pop data is in 1000s.

			// if((Data.Pop> 0) && (Data.Cases > 0))
			if(Data.Pop > 0)
			{
				Data.PerCapita = Data.Cases / Data.Pop;
				Data.DeathsPerCapita = Data.Deaths / Data.Pop;
				if(Data.Cases > 0)
					Data.DeathRate = Data.Deaths / Data.Cases;
				else
					Data.DeathRate = 0;
				// console.log("dr = " + Data.DeathRate + " d = " + Data.Deaths + " c = " + Data.Cases);
			}
			else
			{
				Data.PerCapita = 0;
				Data.DeathsPerCapita = 0;
				Data.DeathRate = 0;
			}
		}

		ReportDate[di].Prepped = true;
	}
}

function XYChart(TopLeft, SizeXY, XEmphasis, XYLabels, ValueSeries1, ValueSeries2, Option)
{
	var x,y;
	var Max = 0;
	var XScale,YScale;
	var GrowthPercent;
	var TextYOffset;
	var RunningAverage = [];
	var RunningAveragePeriods = 10;

	for(x=0;x<ValueSeries1.length;x++)
	{
		if(Max < ValueSeries1[x])
			Max = ValueSeries1[x];
		if(Max < ValueSeries2[x])
			Max = ValueSeries2[x];
	}

	YScale = SizeXY[1] / Max;
	XScale = SizeXY[0] / (ValueSeries1.length-1);	// subtract 1 because Y axis is first point on scale

	ctx.globalAlpha = 1.0;
	ctx.strokeStyle = "black";
	ctx.lineWidth = 2;
	ctx.textAlign = "center";
	ctx.textBaseline = "bottom";

	ctx.beginPath();
	ctx.moveTo(TopLeft[0],TopLeft[1]);
	ctx.lineTo(TopLeft[0],TopLeft[1]+SizeXY[1]);
	ctx.lineTo(TopLeft[0]+SizeXY[0],TopLeft[1]+SizeXY[1]);
	// ctx.closePath();
	ctx.stroke();
	ctx.lineWidth = 1;
	if(SizeXY[0] > 150)
	{
		ctx.font = "normal 10pt Courier";
		TextYOffset = 14;
	}
	else
	{
		ctx.font = "normal 6pt Courier";
		TextYOffset = 10;
	}
	ctx.strokeText(XYLabels[0],TopLeft[0]+(SizeXY[0]/2),TopLeft[1]+SizeXY[1]+(TextYOffset*2));
	ctx.strokeText(XYLabels[1],TopLeft[0]+(SizeXY[0]/2),TopLeft[1]);

	ctx.textAlign="right";
	ctx.strokeText((Max/2).toFixed(0),TopLeft[0]-6,TopLeft[1]+(SizeXY[1]/2));
	ctx.strokeText(((Max/2)+(Max/4)).toFixed(0),TopLeft[0]-6,TopLeft[1]+(SizeXY[1]/4));
	ctx.strokeText((Max/4).toFixed(0),TopLeft[0]-6,TopLeft[1]+(SizeXY[1]/2)+(SizeXY[1]/4));
	ctx.strokeText(Max,TopLeft[0]+8,TopLeft[1]);
	ctx.textAlign="center";
	for(x=0;x<=ValueSeries1.length-1;x++)
	{
		if(x == XEmphasis)
		{
			ctx.globalAlpha = 1.0;
			ctx.strokeStyle = "green";
		}
		else
		{
			ctx.globalAlpha = 0.5;
			ctx.strokeStyle = "gray";
		}
		ctx.beginPath();
		ctx.moveTo(TopLeft[0]+(XScale*x),TopLeft[1]);
		ctx.lineTo(TopLeft[0]+(XScale*x),TopLeft[1]+SizeXY[1]);
		ctx.stroke();
		if((x % 20) == 0)
		{
			ctx.globalAlpha = 1.0;
			ctx.strokeStyle = "black";
			ctx.strokeText(x,TopLeft[0]+(XScale*x),TopLeft[1]+SizeXY[1]+TextYOffset);
		}

	}

	// draw series1 shape and fill
	ctx.globalAlpha = 0.5;
	ctx.strokeStyle = "darkred";
	ctx.fillStyle = "darkred";
	ctx.beginPath();
	//ctx.moveTo(TopLeft[0],TopLeft[1]+(SizeXY[1]-ValueSeries1[0]));
	ctx.moveTo(TopLeft[0],TopLeft[1]+(SizeXY[1]-(ValueSeries1[0]*YScale)));
	for(x=1;x<ValueSeries1.length;x++)
		ctx.lineTo(TopLeft[0]+(XScale*x),TopLeft[1]+(SizeXY[1]-(ValueSeries1[x]*YScale)));
	ctx.lineTo(TopLeft[0]+SizeXY[0],TopLeft[1]+SizeXY[1]);
	ctx.lineTo(TopLeft[0],TopLeft[1]+SizeXY[1]);
	ctx.stroke();
	ctx.closePath();
	ctx.fill();

	if(Option == 0)	// do 10 day running average
	{
		var GoBack;
		for(x=0;x<ValueSeries1.length;x++)
		{
			if(x < RunningAveragePeriods)
				GoBack = 0;
			else
				GoBack = x - RunningAveragePeriods;

			RunningAverage[x] = 0;
			for(y=GoBack;y<x;y++)
				RunningAverage[x] += ValueSeries1[y];
			if(x != 0)
				RunningAverage[x] /= (x - GoBack);
		}
		ctx.globalAlpha = 0.5;
		ctx.strokeStyle = "black";
		ctx.beginPath();
		ctx.moveTo(TopLeft[0],TopLeft[1]+(SizeXY[1]-(RunningAverage[0]*YScale)));
		for(x=1;x<RunningAverage.length;x++)
			ctx.lineTo(TopLeft[0]+(XScale*x),TopLeft[1]+(SizeXY[1]-(RunningAverage[x]*YScale)));
		ctx.lineTo(TopLeft[0]+SizeXY[0],TopLeft[1]+SizeXY[1]);
		ctx.lineTo(TopLeft[0],TopLeft[1]+SizeXY[1]);
		ctx.stroke();
	}
	
	if(Option == 1)
	{
		// draw series1 growth shapes and fill **_**
		ctx.globalAlpha = 0.5;
		// console.log("---");
		for(x=1;x<ValueSeries1.length;x++)
		{
			if(ValueSeries1[x-1] == 0)
				ctx.fillStyle = "gray";
			else
			{
				GrowthPercent = Number((ValueSeries1[x] - ValueSeries1[x-1]) / ValueSeries1[x-1]);
				if(GrowthPercent > 0.2)
					ctx.fillStyle = GrowthRateColors[5];
				else
					if(GrowthPercent > 0.1)
						ctx.fillStyle = GrowthRateColors[4];
					else
						if(GrowthPercent > 0.05)
							ctx.fillStyle = GrowthRateColors[3];
						else
							if(GrowthPercent > 0.01)
								ctx.fillStyle = GrowthRateColors[2];
							else
								if(GrowthPercent > 0.001)
									ctx.fillStyle = GrowthRateColors[1];
								else
									if(GrowthPercent < 0)
										ctx.fillStyle = "gray";	// invalid data
									else
										ctx.fillStyle = GrowthRateColors[0];
				// console.log("Growth percent = " + GrowthPercent + " fillstyle = " + ctx.fillStyle);
			}
			ctx.beginPath();
			ctx.moveTo(TopLeft[0]+(XScale*(x-1)),TopLeft[1]+(SizeXY[1]-(ValueSeries1[x-1]*YScale)));
			ctx.lineTo(TopLeft[0]+(XScale*x),TopLeft[1]+(SizeXY[1]-(ValueSeries1[x]*YScale)));
			ctx.lineTo(TopLeft[0]+(XScale*x),TopLeft[1]);
			ctx.lineTo(TopLeft[0]+(XScale*(x-1)),TopLeft[1]);
			ctx.lineTo(TopLeft[0]+(XScale*(x-1)),TopLeft[1]+(SizeXY[1]-(ValueSeries1[x-1]*YScale)));
			ctx.closePath();
			ctx.fill();
		}
	}

	// draw series2 shape and fill
	ctx.globalAlpha = 0.5;
	ctx.strokeStyle = "white";
	ctx.fillStyle = "black";
	ctx.beginPath();
	// ctx.moveTo(TopLeft[0],TopLeft[1]+(SizeXY[1]-ValueSeries2[0]));
	ctx.moveTo(TopLeft[0],TopLeft[1]+(SizeXY[1]-(ValueSeries2[0]*YScale)));
	for(x=1;x<ValueSeries2.length;x++)
		ctx.lineTo(TopLeft[0]+(XScale*x),TopLeft[1]+(SizeXY[1]-(ValueSeries2[x]*YScale)));
	ctx.lineTo(TopLeft[0]+SizeXY[0],TopLeft[1]+SizeXY[1]);
	ctx.lineTo(TopLeft[0],TopLeft[1]+SizeXY[1]);
	ctx.stroke();
	ctx.closePath();
	ctx.fill();

	ctx.textAlign = "left";
	ctx.textBaseline = "bottom";
}

function Pie(CenterX, CenterY, Radius, Amounts, Labels)
{
	var x,y;
	var cx,cy;
	var lx,ly;
	var Total = 0;
	var Percents = [];
	var Radians = [];
	var LineWidth = 20;
	var RadiansSoFar = 0;
 
	var Color1 = "#7878A0";
	var Color2 = "#404080";
	var Color3 = "#9090C0";
 
	for(x=0;x<Amounts.length;x++)
	{
		Total += Amounts[x];
	}

	if(Total == 0)
	{
		ctx.textAlign = "center";
		ctx.textBaseline = "bottom";
		ctx.fillStyle = "10px Courier black";
		ctx.fillText("(No data to report)",CenterX,CenterY);
		ctx.textAlign = "left";
		ctx.textBaseline = "bottom";
		return;
	}
 
	for(x=0;x<Amounts.length;x++)
	{
		Percents[x] = Amounts[x] / Total;
	}
 
	for(x=0;x<Amounts.length;x++)
	{
		Radians[x] = Percents[x] * (Math.PI * 2);
	}
 
	// ctx.font = "normal 8pt Courier";
	// ctx.setBaseline = "top";
	// ctx.textBaseline="middle";
	ctx.textAlign = "center";
	ctx.textBaseline = "bottom";
	for(x=0;x<Amounts.length;x++)
	{
		// draw arc of graph
		// ctx.fillStyle = ctx.strokeStyle = x==0?Color3:(x%2)==1?Color1:Color2;
		ctx.strokeStyle = ctx.fillStyle = CountyColors[x];
		ctx.beginPath();
		ctx.lineWidth = LineWidth;
		ctx.arc(CenterX,CenterY,Radius,RadiansSoFar,RadiansSoFar + Radians[x]);
		ctx.stroke();
 
		// draw label line and label
		ctx.beginPath();
		ctx.lineWidth = 2;
		lx = cx = CenterX + (Radius * Math.cos(RadiansSoFar+(Radians[x]/2)));
		ly = cy = CenterY + (Radius * Math.sin(RadiansSoFar+(Radians[x]/2)));
		ctx.moveTo(cx,cy);
		cx = CenterX + ((Radius+10) * Math.cos(RadiansSoFar+(Radians[x]/2)));
		cy = CenterY + ((Radius+10) * Math.sin(RadiansSoFar+(Radians[x]/2)));
		ctx.lineTo(cx,cy);
		ctx.stroke();

		// Draw separating line
		ctx.beginPath();
		ctx.strokeStyle = "darkgray";
		ctx.lineWidth = 5;
		cx = CenterX+((Radius * Math.cos(RadiansSoFar+Radians[x]))*1.2);
		cy = CenterY+((Radius * Math.sin(RadiansSoFar+Radians[x]))*1.2);
		ctx.moveTo(CenterX,CenterY);
		ctx.lineTo(cx,cy);
		ctx.stroke();

		RadiansSoFar += Radians[x];
	}

	// draw labels on top of pie segments
	RadiansSoFar = 0;
	ctx.lineWidth = 1;
	ctx.fillStyle = "black";
	ctx.strokeStyle = "white";
	for(x=0;x<Amounts.length;x++)
	{
		cx = CenterX + ((Radius+10) * Math.cos(RadiansSoFar+(Radians[x]/2)));
		cy = CenterY + ((Radius+10) * Math.sin(RadiansSoFar+(Radians[x]/2)));
		ctx.strokeText(Labels[x],cx,cy);
		ctx.fillText(Labels[x],cx,cy);
		RadiansSoFar += Radians[x];
	}

	// draw total amount in center
	ctx.fillStyle = "black";
	ctx.strokeStyle = "white";
	ctx.strokeText(Total,CenterX,CenterY);
	ctx.fillText(Total,CenterX,CenterY);

	ctx.textAlign = "left";
	ctx.textBaseline = "bottom";
}

var CountyColors = [ "#1c1a6e","#696e1a","#1a6e28","#1b6769","#645c65","#ba4a00" ];
var SeverityColors = [ "#c0c0c0", "#ff6a1f", "#ba4000", "#ff0000" ];
var DeathSeverityColors = [ "#c0c0c0", "#ff6a1f", "#ba4000", "#ff4000", "#ff0000" ];
var DeathRateColors = [ "#c0c0c0", "#a0a0a0", "#808080", "#404040", "#000000" ];
var GrowthRateColors = [ "#ffffff", "#ffc0c0", "#ffa090", "#ff7050", "#ff3600", "#ff0000" ];
var canvas = document.getElementById("ChartArea");
var ctx = canvas.getContext("2d");
var DateIndex = ReportDate.length-1;	// Start with latest date in set
var StateIndex;
var CountyIndex;
var DisplayIndex = 0;
var ClickData;
var x,y,z;

for(x=0;x<ReportDate.length;x++)
	ReportDate[x].Prepped = false;

ClearScreen();
PrepData();

var DateText = document.getElementById("DataDate");
DateText.innerHTML = "Data from " + ReportDate[0].Date + " to " + ReportDate[DateIndex].Date;
var StateSelect = document.getElementById("CountrySelect");
var SortedData = ReportDate[DateIndex].Data.sort(function(a,b) { return a.Region.localeCompare(b.Region) } );
var StateElem = document.createElement("option");
StateSelect.options.length = 0;
StateSelect.style.display = "inline";
StateElem.text = "Pick a country";
StateSelect.options.add(StateElem,0);
for(x=0;x<SortedData.length;x++)
{
	StateElem = document.createElement("option");
	StateElem.text = SortedData[x].Region;
	StateSelect.options.add(StateElem,x+1);
}

function DrawCountyData()
{
	var dx,dy;
	var x,y;
	var z;
	var StatColumn = 200;
	var FontSize = 14;
	var Amounts = [];
	var Labels = [];
	var ChartCases = [];
	var ChartFatalities = [];

	// Detailed stats
	dx = 20;
	dy = 30;

	ctx.globalAlpha = 1.0;
	ctx.font = "normal 18px Courier";
	ctx.fillStyle = "blue";
	ctx.fillText(ClickData.Region,dx,dy);
	dy += FontSize;

	ctx.font = "normal 12px Courier";

	if(ClickData.Pop!= 0)
	{
		dy += FontSize;
		ctx.fillStyle = "green";
		ctx.fillText("Pop:",dx,dy);
		ctx.fillText(ClickData.Pop,dx+StatColumn,dy);
	}

	/*
	if(ClickData.SqMi!= 0)
	{
		dy += FontSize;
		ctx.fillText("Square Miles:",dx,dy);
		ctx.fillText(ClickData.SqMi,dx+StatColumn,dy);
	}
	*/

	dy += FontSize;
	ctx.fillStyle = "black";
	ctx.fillText("Total Cases:",dx,dy);
	ctx.fillStyle = "darkred";
	ctx.fillText(ClickData.Cases,dx+StatColumn,dy);
	dy += FontSize;
	ctx.fillStyle = "black";
	ctx.fillText("Total Fatalities:",dx,dy);
	ctx.fillStyle = "darkred";
	ctx.fillText(ClickData.Deaths,dx+StatColumn,dy);

	if(ClickData.Pop!= 0)
	{
		dy += FontSize;
		ctx.fillStyle = "black";
		ctx.fillText("Cases Per Capita:",dx,dy);
		ctx.fillStyle = "darkred";
		z = (ClickData.PerCapita * 100).toFixed(3);
		ctx.fillText(z + "%",dx+StatColumn,dy);
		dy += FontSize;
		ctx.fillStyle = "black";
		ctx.fillText("Fatalities Per Capita:",dx,dy);
		ctx.fillStyle = "darkred";
		z = (ClickData.DeathsPerCapita * 100).toFixed(3);
		ctx.fillText(z + "%",dx+StatColumn,dy);
		dy += FontSize;
		ctx.fillStyle = "black";
		ctx.fillText("Fatality Rate:",dx,dy);
		ctx.fillStyle = "darkred";
		z = (ClickData.DeathRate * 100).toFixed(3);
		ctx.fillText(z + "%",dx+StatColumn,dy);
	}

	dy += FontSize;
	ctx.fillStyle = "black";
	ctx.fillText("New Cases Today:",dx,dy);
	ctx.fillStyle = "darkred";
	ctx.fillText(ClickData.DeltaCases,dx+StatColumn,dy);
	dy += FontSize;
	ctx.fillStyle = "black";
	ctx.fillText("New Fatalities Today:",dx,dy);
	ctx.fillStyle = "darkred";
	ctx.fillText(ClickData.DeltaDeaths,dx+StatColumn,dy);

	dy += FontSize;
	ctx.fillStyle = "black";
	ctx.fillText("10 Day Avg New Cases:",dx,dy);
	ctx.fillStyle = "darkred";
	ctx.fillText(ClickData.RunningAverageCases.toFixed(3),dx+StatColumn,dy);
	dy += FontSize;
	ctx.fillStyle = "black";
	ctx.fillText("10 Day Avg New Fatalities:",dx,dy);
	ctx.fillStyle = "darkred";
	ctx.fillText(ClickData.RunningAverageDeaths.toFixed(3),dx+StatColumn,dy);
	dy += FontSize;
	ctx.fillStyle = "black";
	ctx.fillText("10 Day Case Trend:",dx,dy);
	ctx.fillStyle = "darkred";
	ctx.fillText(ClickData.TrendCases.toFixed(3),dx+StatColumn,dy);
	dy += FontSize;
	ctx.fillStyle = "black";
	ctx.fillText("10 Day Fatality Trend:",dx,dy);
	ctx.fillStyle = "darkred";
	ctx.fillText(ClickData.TrendDeaths.toFixed(3),dx+StatColumn,dy);
	dy += FontSize;
	ctx.fillStyle = "black";
	ctx.fillText("Case Trend Direction:",dx,dy);
	ctx.fillStyle = "darkred";
	ctx.fillText(ClickData.TrendCases==0?"Even":ClickData.TrendCases<0?"Down":"Up",dx+StatColumn,dy);
	dy += FontSize;
	ctx.fillStyle = "black";
	ctx.fillText("Fatality Trend Direction:",dx,dy);
	ctx.fillStyle = "darkred";
	ctx.fillText(ClickData.TrendDeaths==0?"Even":ClickData.TrendDeaths<0?"Down":"Up",dx+StatColumn,dy);

	ctx.textAlign = "left";
	ctx.textBaseline = "bottom";
}

function RefreshOptionFields()
{
	// this ugliness was required because select/options don't refresh correctly in firefox
	var RefreshArea = document.getElementById("RefreshThis");
	var OldStyle = RefreshArea.style.display;
	RefreshArea.style.display = "none";
	setTimeout(function() { RefreshArea.style.display = OldStyle }, 100);
}

StateSelect.onchange = function()
{
	var ChartDim = [500,350];
	var ChartLoc = [340,50];

	RefreshOptionFields();

	var StateIndex = StateSelect.selectedIndex;
	var State = StateSelect[StateIndex].text;

	// we have to find out county data array
	var DataArray = ReportDate[DateIndex].Data;
	for(x=0;x<DataArray.length;x++)
	{
		if(	DataArray[x].Region.localeCompare(State) == 0)
		{
			ClickData = DataArray[x];
			break;
		}
	}

	if(x == ReportDate[DateIndex].length)
	{
		console.log(State + " was not found");
		return;
	}
	
	// now get history data for that county
	var UndefinedData = { Cases : 0, Deaths : 0 };
	ClickData.HistoryData = new Array(ReportDate.length);	// for tying clickdata to other dates for graphs
	for(x=0;x<ReportDate.length;x++)
	{
		for(y=0;y<ReportDate[x].Data.length;y++)
		{
			if(ReportDate[x].Data[y].Region.localeCompare(ClickData.Region)==0)
			/*
			if(	(ReportDate[x].Data[y].FIPS == ClickData.FIPS)||	// some counties (particularly in CA and TX) were not reporing the same FIPS code consistently
				((ReportDate[x].Data[y].Lat == ClickData.Lat) && (ReportDate[x].Data[y].Long == ClickData.Long)))
			*/
			{
				ClickData.HistoryData[x] = ReportDate[x].Data[y];
				break;
			}
		}
		if(y == ReportDate[x].Data.length)	// was it not found?
			ClickData.HistoryData[x] = UndefinedData;
	}

	// Create some addition stats based on history

	// delta from prior date
	for(x=0;x<ClickData.HistoryData.length;x++)
	{
		if(x == 0)
		{
			ClickData.HistoryData[x].DeltaCases = 0;
			ClickData.HistoryData[x].DeltaDeaths = 0;
		}
		else
		{
			ClickData.HistoryData[x].DeltaCases = ClickData.HistoryData[x].Cases - ClickData.HistoryData[x-1].Cases;
			if(ClickData.HistoryData[x].DeltaCases < 0)
				ClickData.HistoryData[x].DeltaCases = 0;

			ClickData.HistoryData[x].DeltaDeaths = ClickData.HistoryData[x].Deaths - ClickData.HistoryData[x-1].Deaths;
			if(ClickData.HistoryData[x].DeltaDeaths < 0)
				ClickData.HistoryData[x].DeltaDeaths = 0;
		}
	}

	// 10 day running average
	var RunningAverageDays = 10;
	for(x=0;x<ClickData.HistoryData.length;x++)
	{
		ClickData.HistoryData[x].RunningAverageCases = 0;
		ClickData.HistoryData[x].RunningAverageDeaths = 0;
		if(x < RunningAverageDays)
		{
			for(y=0;y<=x;y++)
			{
				ClickData.HistoryData[x].RunningAverageCases += ClickData.HistoryData[y].DeltaCases;
				ClickData.HistoryData[x].RunningAverageDeaths += ClickData.HistoryData[y].DeltaDeaths;
			}
			ClickData.HistoryData[x].RunningAverageCases /= (x+1);
			ClickData.HistoryData[x].RunningAverageDeaths /= (x+1);
		}
		else
		{
			for(y=x-RunningAverageDays;y<=x;y++)
			{
				ClickData.HistoryData[x].RunningAverageCases += ClickData.HistoryData[y].DeltaCases;
				ClickData.HistoryData[x].RunningAverageDeaths += ClickData.HistoryData[y].DeltaDeaths;
			}
			ClickData.HistoryData[x].RunningAverageCases /= (RunningAverageDays+1);
			ClickData.HistoryData[x].RunningAverageDeaths /= (RunningAverageDays+1);
		}

		if(x == 0)
		{
			ClickData.HistoryData[x].TrendCases = 0;
			ClickData.HistoryData[x].TrendDeaths = 0;
		}
		else
		{
			ClickData.HistoryData[x].TrendCases = ClickData.HistoryData[x].RunningAverageCases - ClickData.HistoryData[x-1].RunningAverageCases;
			ClickData.HistoryData[x].TrendDeaths = ClickData.HistoryData[x].RunningAverageDeaths - ClickData.HistoryData[x-1].RunningAverageDeaths;
		}
	}

	// Now go through history data and create chart series
	var Cases = [];
	var Deaths = [];
	var DeltaCases = [];
	var DeltaDeaths = [];

	for(x=0;x<ClickData.HistoryData.length;x++)
	{
		Cases[x] = ClickData.HistoryData[x].Cases;
		Deaths[x] = ClickData.HistoryData[x].Deaths;
		DeltaCases[x] = ClickData.HistoryData[x].DeltaCases;
		DeltaDeaths[x] = ClickData.HistoryData[x].DeltaDeaths;
	}

	ClearScreen();
	
	DrawCountyData();

	XYChart(ChartLoc,ChartDim,ReportDate.length-1,["Days since 3/22","Total Cases"],Cases,Deaths,1);

	// XYChart([ChartLoc[0],ChartLoc[1]+ChartDim[1]+70],[ChartDim[0],ChartDim[1]/3],ReportDate.length-1,["Days since 3/22","Daily Cases With 10 Day Trend"],DeltaCases,DeltaDeaths,0);
	XYChart([ChartLoc[0],ChartLoc[1]+ChartDim[1]+70],[ChartDim[0],ChartDim[1]],ReportDate.length-1,["Days since 3/22","Daily Cases With 10 Day Trend"],DeltaCases,DeltaDeaths,0);
}

</script>

</html>
