<!DOCTYPE html>
<html>
<meta charset = "UTF-8">
<style type="text/css">
	.LText { font-family: Courier; font-size:16px; font-weight:bold; vertical-align: top; text-align: left; background-color: white; }
	.RText { font-family: Courier; font-size:16px; font-weight:bold; vertical-align: top; text-align: right; background-color: white; }
	.CText { font-family: Courier; font-size:16px; font-weight:bold; vertical-align: top; text-align: center; color: black; background-color: white; }
    .Table { display:table }
    .Row { display: table-row; background-color: white; height: 40px; }
    .Cell { display: table-cell; vertical-align: top; text-align: left; border: 0px solid black; padding-left: 5px; padding-right: 5px; }
    .CharCell { display: table-cell; column-span:2; vertical-align: top; border: 0px solid black; padding-left: 0px; padding-right: 0px; width:1000px}
</style>
<body>
<div class = "Table">
	<div class = "Row">
			<div class = "Cell" id="RefreshThis">
				<div class = "LText" id="DataDate">Loading...</div>
				<select hidden class="LText" id="CountrySelect"><option>Loading...</option></select>
				<select hidden class="LText" id="RegionSelect"></select>
			</div>
	</div>
	<div class = "Row">
		<div class = "ChartCell">
			<canvas id="ChartArea" width=1000 height=1000 style="border:0px solid #ffffff; background-color:white;">
			Your browser does not support HTML5
			</canvas>
		</div>
	</div>
</div>

</body>

<script src=RegData_0.js></script>
<script src=RegData_1.js></script>
<script src=RegData_2.js></script>
<script src=RegData_3.js></script>
<script src=RegData_4.js></script>
<script src=RegData_5.js></script>
<script src=RegData_6.js></script>
<script src=RegData_7.js></script>
<script src=RegData_8.js></script>
<script src=RegData_9.js></script>
<script src=RegData_10.js></script>
<script src=RegData_11.js></script>
<script src=RegData_12.js></script>
<script src=RegData_13.js></script>
<script src=RegData_14.js></script>
<script src=RegData_15.js></script>
<script src=RegData_16.js></script>
<script src=RegData_17.js></script>
<script src=RegData_18.js></script>
<script src=RegData_19.js></script>
<script src=RegData_20.js></script>
<script src=RegData_21.js></script>
<script src=RegData_22.js></script>
<script src=RegData_23.js></script>
<script src=RegData_24.js></script>
<script src=RegData_25.js></script>
<script src=RegData_26.js></script>
<script src=RegData_27.js></script>
<script src=RegData_28.js></script>
<script src=RegData_29.js></script>
<script src=RegData_30.js></script>
<script src=RegData_31.js></script>
<script src=RegData_32.js></script>
<script src=RegData_33.js></script>
<script src=RegData_34.js></script>
<script src=RegData_35.js></script>
<script src=RegData_36.js></script>
<script src=RegData_37.js></script>
<script src=RegData_38.js></script>
<script src=RegData_39.js></script>
<script src=RegData_40.js></script>
<script src=RegData_41.js></script>
<script src=RegData_42.js></script>
<script src=RegData_43.js></script>
<script src=RegData_44.js></script>
<script src=RegData_45.js></script>
<script src=RegData_46.js></script>
<script src=RegData_47.js></script>
<script src=RegData_48.js></script>
<script src=RegData_49.js></script>
<script src=RegData_50.js></script>
<script src=RegData_51.js></script>
<script src=RegData_52.js></script>
<script src=RegData_53.js></script>
<script src=RegData_54.js></script>
<script src=RegData_55.js></script>
<script src=RegData_56.js></script>
<script src=RegData_57.js></script>
<script src=RegData_58.js></script>
<script src=RegData_59.js></script>
<script src=RegData_60.js></script>
<script src=RegData_61.js></script>
<script src=RegData_62.js></script>
<script src=RegData_63.js></script>
<script src=RegData_64.js></script>
<script src=RegData_65.js></script>
<script src=RegData_66.js></script>
<script src=RegData_67.js></script>
<script src=RegData_68.js></script>
<script src=RegData_69.js></script>
<script src=RegData_70.js></script>
<script src=RegData_71.js></script>
<script src=RegData_72.js></script>
<script src=RegData_73.js></script>
<script src=RegData_74.js></script>
<script src=RegData_75.js></script>
<script src=RegData_76.js></script>
<script src=RegData_77.js></script>
<script src=RegData_78.js></script>
<script src=RegData_79.js></script>
<script src=RegData_80.js></script>
<script src=RegData_81.js></script>
<script src=RegData_82.js></script>
<script src=RegData_83.js></script>
<script src=RegData_84.js></script>
<script src=RegData_85.js></script>
<script src=RegData_86.js></script>
<script src=RegData_87.js></script>
<script src=RegData_88.js></script>
<script src=RegData_89.js></script>
<script src=RegData_90.js></script>
<script src=RegData_91.js></script>
<script src=RegData_92.js></script>
<script src=RegData_93.js></script>
<script src=RegData_94.js></script>
<script src=RegData_95.js></script>
<script src=RegData_96.js></script>
<script src=RegData_97.js></script>
<script src=RegData_98.js></script>
<script src=RegData_99.js></script>
<script src=RegData_100.js></script>
<script src=RegData_101.js></script>
<script src=RegData_102.js></script>
<script src=RegData_103.js></script>
<script src=RegData_104.js></script>
<script src=RegData_105.js></script>
<script src=RegData_106.js></script>
<script src=RegData_107.js></script>
<script src=RegData_108.js></script>
<script src=RegData_109.js></script>
<script src=RegData_110.js></script>
<script src=RegData_111.js></script>
<script src=RegData_112.js></script>
<script src=RegData_113.js></script>
<script src=RegData_114.js></script>
<script src=RegData_115.js></script>
<script src=RegData_116.js></script>
<script src=RegData_117.js></script>
<script src=RegData_118.js></script>
<script src=RegData_119.js></script>
<script src=RegData_120.js></script>
<script src=RegData_121.js></script>
<script src=RegData_122.js></script>
<script src=RegData_123.js></script>
<script src=RegData_124.js></script>
<script src=RegData_125.js></script>
<script src=RegData_126.js></script>
<script src=RegData_127.js></script>
<script src=RegData_128.js></script>
<script src=RegData_129.js></script>
<script src=RegData_130.js></script>
<script src=RegData_131.js></script>
<script src=RegData_132.js></script>
<script src=RegData_133.js></script>
<script src=RegData_134.js></script>
<script src=RegData_135.js></script>
<script src=RegData_136.js></script>
<script src=RegData_137.js></script>
<script src=RegData_138.js></script>
<script src=RegData_139.js></script>
<script src=RegData_140.js></script>
<script src=RegData_141.js></script>
<script src=RegData_142.js></script>
<script src=RegData_143.js></script>
<script src=RegData_144.js></script>
<script src=RegData_145.js></script>
<script src=RegData_146.js></script>
<script src=RegData_147.js></script>
<script src=RegData_148.js></script>
<script src=RegData_149.js></script>
<script src=RegData_150.js></script>
<script src=RegData_151.js></script>
<script src=RegData_152.js></script>
<script src=RegData_153.js></script>
<script src=RegData_154.js></script>
<script src=RegData_155.js></script>
<script src=RegData_156.js></script>
<script src=RegData_157.js></script>
<script src=RegData_158.js></script>
<script src=RegData_159.js></script>
<script src=RegData_160.js></script>
<script src=RegData_161.js></script>
<script src=RegData_162.js></script>
<script src=RegData_163.js></script>
<script src=RegData_164.js></script>
<script src=RegData_165.js></script>
<script src=RegData_166.js></script>

<script>

function DecToHex(h)
{
	if(h < 0)
		return("00");
	if(h < 15)
		return("0" + h.toString(16));
	if(h > 255)
		return("ff");
	return(h.toString(16));
}

function ClearScreen()
{
	// clear canvas
	ctx.globalAlpha = 1.0;
	ctx.fillStyle = "white";
	ctx.fillRect(0,0,canvas.width,canvas.height);
}

function DrawDates(Left, Down, Width, Dates)
{
	var x,z,Inset,m,d;
	var Names = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

	var Scale = Width / Dates.length;

	ctx.globalAlpha = 0.8;
	ctx.strokeStyle = "black";
	ctx.lineWidth = 2;
	ctx.textAlign = "center";
	ctx.textBaseline = "bottom";
	ctx.font = "normal 8pt Courier";
	Inset = Left+Scale;
	for(x=0;x<Dates.length;x+=5)
	{
		z = 0;
		m = Names[Number(Dates[x].slice(5,7))-1];
		d = Dates[x].slice(8,10);
		// var md = d + "|" + m;

		ctx.fillText(d,Inset,Down+z*(12));
		for(z=0;z<m.length;z++)
			ctx.fillText(m[z],Inset,Down+((z+1)*12));
		// ctx.strokeText(m + "/" + d,Inset,Down);
		Inset += (Scale*5);
	}
	ctx.textAlign = "left";
}

function XYChart(TopLeft, SizeXY, XEmphasis, Title, ValueSeries1, ValueSeries2, Option)
{
	var x,y;
	var Max = 0;
	var Min = ValueSeries1[0];
	var XScale,YScale;
	var GrowthPercent;
	var TextYOffset;
	var RunningAverage = [];
	var RunningAveragePeriods = 10;

	// eliminate leading zero values
	/*
	for(y=x=0;x<ValueSeries1.length;x++)
	{
		if(ValueSeries1[x] == 0)
			y++;
		else
			break;
	}

	for(x=0;x<y;x++)
	{
		ValueSeries1.shift();
		ValueSeries2.shift();
	}
	*/

	for(x=0;x<ValueSeries1.length;x++)
	{
		if(Max < ValueSeries1[x])
			Max = ValueSeries1[x];
		if(Max < ValueSeries2[x])
			Max = ValueSeries2[x];

		if(Min > ValueSeries1[x])
			Min = ValueSeries1[x];
		if(Min > ValueSeries2[x])
			Min = ValueSeries2[x];
	}

	// YScale = SizeXY[1] / (Max-Min);
	YScale = SizeXY[1] / Max;
	XScale = SizeXY[0] / (ValueSeries1.length-1);	// subtract 1 because Y axis is first point on scale

	ctx.globalAlpha = 1.0;
	ctx.strokeStyle = "black";
	ctx.lineWidth = 2;
	ctx.textAlign = "center";
	ctx.textBaseline = "bottom";

	ctx.beginPath();
	ctx.moveTo(TopLeft[0],TopLeft[1]);
	ctx.lineTo(TopLeft[0],TopLeft[1]+SizeXY[1]);
	ctx.lineTo(TopLeft[0]+SizeXY[0],TopLeft[1]+SizeXY[1]);
	// ctx.closePath();
	ctx.stroke();
	ctx.lineWidth = 1;
	if(SizeXY[0] > 150)
	{
		ctx.font = "normal 10pt Courier";
		TextYOffset = 14;
	}
	else
	{
		ctx.font = "normal 6pt Courier";
		TextYOffset = 10;
	}
	
	ctx.strokeText(Title,TopLeft[0]+(SizeXY[0]/2),TopLeft[1]);

	ctx.textAlign="right";
	ctx.strokeText((Max/2).toFixed(0),TopLeft[0]-6,TopLeft[1]+(SizeXY[1]/2));
	ctx.strokeText(((Max/2)+(Max/4)).toFixed(0),TopLeft[0]-6,TopLeft[1]+(SizeXY[1]/4));
	ctx.strokeText((Max/4).toFixed(0),TopLeft[0]-6,TopLeft[1]+(SizeXY[1]/2)+(SizeXY[1]/4));
	ctx.strokeText(Max,TopLeft[0]+8,TopLeft[1]);
	ctx.textAlign="center";
	for(x=0;x<=ValueSeries1.length-1;x++)
	{
		if(x == XEmphasis)
		{
			ctx.globalAlpha = 1.0;
			ctx.strokeStyle = "green";
		}
		else
		{
			ctx.globalAlpha = 0.5;
			ctx.strokeStyle = "gray";
		}
		ctx.beginPath();
		ctx.moveTo(TopLeft[0]+(XScale*x),TopLeft[1]);
		ctx.lineTo(TopLeft[0]+(XScale*x),TopLeft[1]+SizeXY[1]);
		ctx.stroke();
		/*
		if((x % 5) == 0)
		{
			ctx.globalAlpha = 1.0;
			ctx.strokeStyle = "black";
			ctx.strokeText(x,TopLeft[0]+(XScale*x),TopLeft[1]+SizeXY[1]+TextYOffset);
		}
		*/
	}

	// draw series1 shape and fill
	ctx.globalAlpha = 0.5;
	ctx.strokeStyle = "darkred";
	ctx.fillStyle = "darkred";
	ctx.beginPath();
	//ctx.moveTo(TopLeft[0],TopLeft[1]+(SizeXY[1]-ValueSeries1[0]));
	ctx.moveTo(TopLeft[0],TopLeft[1]+(SizeXY[1]-(ValueSeries1[0]*YScale)));
	for(x=1;x<ValueSeries1.length;x++)
		ctx.lineTo(TopLeft[0]+(XScale*x),TopLeft[1]+(SizeXY[1]-(ValueSeries1[x]*YScale)));
	ctx.lineTo(TopLeft[0]+SizeXY[0],TopLeft[1]+SizeXY[1]);
	ctx.lineTo(TopLeft[0],TopLeft[1]+SizeXY[1]);
	ctx.stroke();
	ctx.closePath();
	ctx.fill();

	if(Option == 0)	// do 10 day running average
	{
		var GoBack;
		for(x=0;x<ValueSeries1.length;x++)
		{
			if(x < RunningAveragePeriods)
				GoBack = 0;
			else
				GoBack = x - RunningAveragePeriods;

			RunningAverage[x] = 0;
			for(y=GoBack;y<x;y++)
				RunningAverage[x] += ValueSeries1[y];
			if(x != 0)
				RunningAverage[x] /= (x - GoBack);
		}
		ctx.globalAlpha = 0.5;
		ctx.strokeStyle = "black";
		ctx.beginPath();
		ctx.moveTo(TopLeft[0],TopLeft[1]+(SizeXY[1]-(RunningAverage[0]*YScale)));
		for(x=1;x<RunningAverage.length;x++)
			ctx.lineTo(TopLeft[0]+(XScale*x),TopLeft[1]+(SizeXY[1]-(RunningAverage[x]*YScale)));
		ctx.lineTo(TopLeft[0]+SizeXY[0],TopLeft[1]+SizeXY[1]);
		ctx.lineTo(TopLeft[0],TopLeft[1]+SizeXY[1]);
		ctx.stroke();
	}
	
	if(Option == 1)
	{
		// draw series1 growth shapes and fill **_**
		ctx.globalAlpha = 0.5;
		// console.log("---");
		for(x=1;x<ValueSeries1.length;x++)
		{
			if(ValueSeries1[x-1] == 0)
				ctx.fillStyle = "gray";
			else
			{
				GrowthPercent = Number((ValueSeries1[x] - ValueSeries1[x-1]) / ValueSeries1[x-1]);
				if(GrowthPercent > 0.2)
					ctx.fillStyle = GrowthRateColors[5];
				else
					if(GrowthPercent > 0.1)
						ctx.fillStyle = GrowthRateColors[4];
					else
						if(GrowthPercent > 0.05)
							ctx.fillStyle = GrowthRateColors[3];
						else
							if(GrowthPercent > 0.01)
								ctx.fillStyle = GrowthRateColors[2];
							else
								if(GrowthPercent > 0.001)
									ctx.fillStyle = GrowthRateColors[1];
								else
									if(GrowthPercent < 0)
										ctx.fillStyle = "gray";	// invalid data
									else
										ctx.fillStyle = GrowthRateColors[0];
				// console.log("Growth percent = " + GrowthPercent + " fillstyle = " + ctx.fillStyle);
			}
			ctx.beginPath();
			ctx.moveTo(TopLeft[0]+(XScale*(x-1)),TopLeft[1]+(SizeXY[1]-(ValueSeries1[x-1]*YScale)));
			ctx.lineTo(TopLeft[0]+(XScale*x),TopLeft[1]+(SizeXY[1]-(ValueSeries1[x]*YScale)));
			ctx.lineTo(TopLeft[0]+(XScale*x),TopLeft[1]);
			ctx.lineTo(TopLeft[0]+(XScale*(x-1)),TopLeft[1]);
			ctx.lineTo(TopLeft[0]+(XScale*(x-1)),TopLeft[1]+(SizeXY[1]-(ValueSeries1[x-1]*YScale)));
			ctx.closePath();
			ctx.fill();
		}
	}

	// draw series2 shape and fill
	ctx.globalAlpha = 0.5;
	ctx.strokeStyle = "white";
	ctx.fillStyle = "black";
	ctx.beginPath();
	// ctx.moveTo(TopLeft[0],TopLeft[1]+(SizeXY[1]-ValueSeries2[0]));
	ctx.moveTo(TopLeft[0],TopLeft[1]+(SizeXY[1]-(ValueSeries2[0]*YScale)));
	for(x=1;x<ValueSeries2.length;x++)
		ctx.lineTo(TopLeft[0]+(XScale*x),TopLeft[1]+(SizeXY[1]-(ValueSeries2[x]*YScale)));
	ctx.lineTo(TopLeft[0]+SizeXY[0],TopLeft[1]+SizeXY[1]);
	ctx.lineTo(TopLeft[0],TopLeft[1]+SizeXY[1]);
	ctx.stroke();
	ctx.closePath();
	ctx.fill();

	ctx.textAlign = "left";
	ctx.textBaseline = "bottom";
}

function Pie(CenterX, CenterY, Radius, Amounts, Labels)
{
	var x,y;
	var cx,cy;
	var lx,ly;
	var Total = 0;
	var OtherPercent;
	var Percents = [];
	var Radians = [];
	var NewLabels = [];
	var NewAmounts = [];
	var LineWidth = 40;
	var RadiansSoFar = 0;
	var PercentCutoff = 0.05;
	var Other = 0;
 
	var Color1 = "#7878A0";
	var Color2 = "#404080";
	var Color3 = "#9090C0";
 
	for(x=0;x<Amounts.length;x++)
	{
		Total += Amounts[x];
	}

	if(Total == 0)
	{
		ctx.textAlign = "center";
		ctx.textBaseline = "bottom";
		ctx.fillStyle = "10px Courier black";
		ctx.fillText("(No data to report)",CenterX,CenterY);
		ctx.textAlign = "left";
		ctx.textBaseline = "bottom";
		return;
	}
 
	for(y=x=0;x<Amounts.length;x++)
	{
		OtherPercent = Amounts[x] / Total;
		if(OtherPercent < PercentCutoff)
			Other += OtherPercent;
		else
		{
			NewLabels[y] = Labels[x];
			NewAmounts[y] = Amounts[x];
			Percents[y++] = OtherPercent;
		}
	}

	NewLabels[y] = "Other (<" + (PercentCutoff*100) + "%)";
	NewAmounts[y] = 0;	// values doesn't really matter here.
	Percents[y++] = Other;
 
	for(x=0;x<y;x++)
	{
		Radians[x] = Percents[x] * (Math.PI * 2);
	}
 
	ctx.font = "normal 12pt Courier";
	// ctx.setBaseline = "top";
	// ctx.textBaseline="middle";
	ctx.textAlign = "center";
	ctx.textBaseline = "bottom";
	RadiansSoFar = 0;
	for(x=0;x<NewAmounts.length;x++)
	{
		// draw arc of graph
		// ctx.fillStyle = ctx.strokeStyle = x==0?Color3:(x%2)==1?Color1:Color2;
		ctx.strokeStyle = ctx.fillStyle = CountyColors[x%6];
		ctx.beginPath();
		ctx.lineWidth = LineWidth;
		ctx.arc(CenterX,CenterY,Radius,RadiansSoFar,RadiansSoFar + Radians[x]);
		ctx.stroke();
 
		// draw label line and label
		/*
		ctx.beginPath();
		ctx.lineWidth = 2;
		lx = cx = CenterX + (Radius * Math.cos(RadiansSoFar+(Radians[x]/2)));
		ly = cy = CenterY + (Radius * Math.sin(RadiansSoFar+(Radians[x]/2)));
		ctx.moveTo(cx,cy);
		cx = CenterX + ((Radius+50) * Math.cos(RadiansSoFar+(Radians[x]/2)));
		cy = CenterY + ((Radius+50) * Math.sin(RadiansSoFar+(Radians[x]/2)));
		ctx.lineTo(cx,cy);
		ctx.stroke();
		*/

		RadiansSoFar += Radians[x];
	}

	RadiansSoFar = 0;
	for(x=0;x<NewAmounts.length;x++)
	{
		// Draw separating line
		ctx.beginPath();
		ctx.strokeStyle = "white";
		ctx.lineWidth = 5;
		cx = CenterX+((Radius * Math.cos(RadiansSoFar+Radians[x]))*1.2);
		cy = CenterY+((Radius * Math.sin(RadiansSoFar+Radians[x]))*1.2);
		ctx.moveTo(CenterX,CenterY);
		ctx.lineTo(cx,cy);
		ctx.stroke();

		RadiansSoFar += Radians[x];
	}

	// draw labels on top of pie segments
	RadiansSoFar = 0;
	ctx.lineWidth = 1;
	ctx.fillStyle = "black";
	ctx.strokeStyle = "white";
	for(x=0;x<Amounts.length;x++)
	{
		cx = CenterX + ((Radius+10) * Math.cos(RadiansSoFar+(Radians[x]/2)));
		cy = CenterY + ((Radius+10) * Math.sin(RadiansSoFar+(Radians[x]/2)));
		ctx.strokeText(NewLabels[x],cx,cy);
		ctx.fillText(NewLabels[x],cx,cy);
		RadiansSoFar += Radians[x];
	}

	// draw total amount in center
	ctx.fillStyle = "black";
	ctx.strokeStyle = "white";
	ctx.strokeText("Total:" + Total,CenterX,CenterY);
	ctx.fillText("Total:" + Total,CenterX,CenterY);

	ctx.textAlign = "left";
	ctx.textBaseline = "bottom";
}

var CountyColors = [ "#1c1a6e","#696e1a","#1a6e28","#1b6769","#645c65","#ba4a00" ];
var SeverityColors = [ "#c0c0c0", "#ff6a1f", "#ba4000", "#ff0000" ];
var DeathSeverityColors = [ "#c0c0c0", "#ff6a1f", "#ba4000", "#ff4000", "#ff0000" ];
var DeathRateColors = [ "#c0c0c0", "#a0a0a0", "#808080", "#404040", "#000000" ];
var GrowthRateColors = [ "#ffffff", "#ffc0c0", "#ffa090", "#ff7050", "#ff3600", "#ff0000" ];
var canvas = document.getElementById("ChartArea");
var ctx = canvas.getContext("2d");
var DateIndex = ReportDate.length-1;	// Start with latest date in set
var StateIndex;
var CountyIndex;
var DisplayIndex = 0;
var ClickData;
var x,y,z;

ClearScreen();

var DateText = document.getElementById("DataDate");
DateText.innerHTML = "Data from " + ReportDate[0].Date + " to " + ReportDate[DateIndex].Date;
var CountrySelect = document.getElementById("CountrySelect");
var SortedData = ReportDate[DateIndex].Data.sort(
function(a,b) 
	{ 
		o = a.Region.localeCompare(b.Region);
		return(o==0?a.Prov.localeCompare(b.Prov):o);
	} 
);

var StateElem = document.createElement("option");
CountrySelect.options.length = 0;
CountrySelect.style.display = "inline";
StateElem.text = "Pick a country";
CountrySelect.options.add(StateElem,0);
for(z=1,x=0;x<SortedData.length;x++)
{
	for(y=x+1;y<SortedData.length;y++)
	{
		if(SortedData[x].Region.localeCompare(SortedData[y].Region) != 0)
		{
			StateElem = document.createElement("option");
			StateElem.text = SortedData[y].Region;
			CountrySelect.options.add(StateElem,z++);
			x = y-1;
			break;
		}
	}
}

function DrawCountyData()
{
	var dx,dy;
	var x,y;
	var z;
	var StatColumn = 200;
	var FontSize = 14;
	var Amounts = [];
	var Labels = [];
	var ChartCases = [];
	var ChartFatalities = [];

	// Detailed stats
	dx = 20;
	dy = 30;

	ctx.globalAlpha = 1.0;
	ctx.font = "normal 18px Courier";
	ctx.fillStyle = "blue";
	// ctx.fillStyle = CountyColors[x];
	{
		ctx.fillText(ClickData.Prov,dx,dy);

		dy += FontSize;
		ctx.font = "normal 12px Courier";
		ctx.fillStyle = "gray";
		ctx.fillText(ClickData.Region,dx,dy);
		dy += FontSize;
	}

	ctx.font = "normal 12px Courier";
	/*
	if(ClickData.Pop!= 0)
	{
		dy += FontSize;
		ctx.fillStyle = "green";
		ctx.fillText("Pop:",dx,dy);
		ctx.fillText(ClickData.Pop,dx+StatColumn,dy);
	}
	if(ClickData.SqMi!= 0)
	{
		dy += FontSize;
		ctx.fillText("Square Miles:",dx,dy);
		ctx.fillText(Number(ClickData.SqMi).toFixed(2),dx+StatColumn,dy);
	}
	*/
	dy += FontSize;
	ctx.fillStyle = "black";
	ctx.fillText("Total Cases:",dx,dy);
	ctx.fillStyle = "darkred";
	ctx.fillText(ClickData.Cases,dx+StatColumn,dy);
	dy += FontSize;
	ctx.fillStyle = "black";
	ctx.fillText("Total Fatalities:",dx,dy);
	ctx.fillStyle = "darkred";
	ctx.fillText(ClickData.Deaths,dx+StatColumn,dy);

	/*
	if(ClickData.Pop!= 0)
	{
		dy += FontSize;
		ctx.fillStyle = "black";
		ctx.fillText("Cases Per Capita:",dx,dy);
		ctx.fillStyle = "darkred";
		z = (ClickData.PerCapita * 100).toFixed(3);
		ctx.fillText(z + "%",dx+StatColumn,dy);
		dy += FontSize;
		ctx.fillStyle = "black";
		ctx.fillText("Fatalities Per Capita:",dx,dy);
		ctx.fillStyle = "darkred";
		z = (ClickData.DeathsPerCapita * 100).toFixed(3);
		ctx.fillText(z + "%",dx+StatColumn,dy);
		dy += FontSize;
		ctx.fillStyle = "black";
		ctx.fillText("Fatality Rate:",dx,dy);
		ctx.fillStyle = "darkred";
		z = (ClickData.DeathRate * 100).toFixed(3);
		ctx.fillText(z + "%",dx+StatColumn,dy);
	}
	*/

	dy += FontSize;
	ctx.fillStyle = "black";
	ctx.fillText("New Cases Today:",dx,dy);
	ctx.fillStyle = "darkred";
	ctx.fillText(ClickData.DeltaCases,dx+StatColumn,dy);
	dy += FontSize;
	ctx.fillStyle = "black";
	ctx.fillText("New Fatalities Today:",dx,dy);
	ctx.fillStyle = "darkred";
	ctx.fillText(ClickData.DeltaDeaths,dx+StatColumn,dy);

	dy += FontSize;
	ctx.fillStyle = "black";
	ctx.fillText("10 Day Avg New Cases:",dx,dy);
	ctx.fillStyle = "darkred";
	ctx.fillText(ClickData.RunningAverageCases.toFixed(3),dx+StatColumn,dy);
	dy += FontSize;
	ctx.fillStyle = "black";
	ctx.fillText("10 Day Avg New Fatalities:",dx,dy);
	ctx.fillStyle = "darkred";
	ctx.fillText(ClickData.RunningAverageDeaths.toFixed(3),dx+StatColumn,dy);
	dy += FontSize;
	ctx.fillStyle = "black";
	ctx.fillText("10 Day Case Trend:",dx,dy);
	ctx.fillStyle = "darkred";
	ctx.fillText(ClickData.TrendCases.toFixed(3),dx+StatColumn,dy);
	dy += FontSize;
	ctx.fillStyle = "black";
	ctx.fillText("10 Day Fatality Trend:",dx,dy);
	ctx.fillStyle = "darkred";
	ctx.fillText(ClickData.TrendDeaths.toFixed(3),dx+StatColumn,dy);
	dy += FontSize;
	ctx.fillStyle = "black";
	ctx.fillText("Case Trend Direction:",dx,dy);
	ctx.fillStyle = "darkred";
	ctx.fillText(ClickData.TrendCases==0?"Even":ClickData.TrendCases<0?"Down":"Up",dx+StatColumn,dy);
	dy += FontSize;
	ctx.fillStyle = "black";
	ctx.fillText("Fatality Trend Direction:",dx,dy);
	ctx.fillStyle = "darkred";
	ctx.fillText(ClickData.TrendDeaths==0?"Even":ClickData.TrendDeaths<0?"Down":"Up",dx+StatColumn,dy);

	ctx.textAlign = "left";
	ctx.textBaseline = "bottom";
}

function RefreshOptionFields()
{
	// this ugliness was required because select/options don't refresh correctly in firefox
	var RefreshArea = document.getElementById("RefreshThis");
	var OldStyle = RefreshArea.style.display;
	RefreshArea.style.display = "none";
	setTimeout(function() { RefreshArea.style.display = OldStyle }, 100);
}

CountrySelect.onchange = function()
{
	var Found = false;
	var CountyElem;
	var x,y,z;

	StateIndex = CountrySelect.selectedIndex;
	var State = CountrySelect[StateIndex].text;

	RegionSelect.options.length = 0;
	CountyElem = document.createElement("option");
	CountyElem.text = "then pick a region";
	RegionSelect.options.add(CountyElem,0);

	CountyElem = document.createElement("option");
	CountyElem.text = "- Show Entire Country -";
	RegionSelect.options.add(CountyElem,1);

	for(z=2,x=0;x<SortedData.length;x++)
	{
		if(SortedData[x].Region.localeCompare(State)==0)
		{
			Found = true;
			CountyElem = document.createElement("option");
			CountyElem.text = SortedData[x].Prov;
			RegionSelect.options.add(CountyElem,z++);
		}
		else
		{
			if(Found)
				break;
		}
	}
	RefreshOptionFields();

	// make a pie chart of the country selected
	ClearScreen();
	var Regions = [];
	var Cases = [];
	var Deaths = [];
	var NumRegions = 0;
	for(x=0;x<ReportDate[DateIndex].Data.length;x++)
	{
		if(ReportDate[DateIndex].Data[x].Region.localeCompare(State) == 0)
		{
			for(y=0;y<Regions.length;y++)
			{
				if(Regions[y].localeCompare(ReportDate[DateIndex].Data[x].Prov) == 0)
				{
					Cases[y] += ReportDate[DateIndex].Data[x].Cases;
					Deaths[y] += ReportDate[DateIndex].Data[x].Deaths;
					break;
				}
			}
			if(y == Regions.length)	// not found
			{
				Regions[NumRegions] = ReportDate[DateIndex].Data[x].Prov;
				Cases[NumRegions] = ReportDate[DateIndex].Data[x].Cases;
				Deaths[NumRegions] = ReportDate[DateIndex].Data[x].Deaths;
				NumRegions++;
			}
		}
	}

	Pie(600,250,200,Cases,Regions);
	// Pie(400,900,Pie2Loc[1],150,Deaths,Regions);
}

var RegionSelect = document.getElementById("RegionSelect");
RegionSelect.style.display = "inline";
RegionSelect.onchange = function()
{
	var ChartDim = [500,350];
	var ChartLoc = [340,50];
	var x,y;

	RefreshOptionFields();

	CountyIndex = RegionSelect.selectedIndex;
	var State = CountrySelect[StateIndex].text;
	var County = RegionSelect[CountyIndex].text;


	if(CountyIndex == 1)	// selection for entire state
	{
		// find state level stats 
		var DataArray = new Array(ReportDate.length);

		for(x=0;x<ReportDate.length;x++)
		{
			DataArray[x] = { Cases:0, Deaths:0, Pop:0, SqMi:0, Adm:"Entire State", Region: "Entire Region", Prov:State };
			for(y=0;y<ReportDate[x].Data.length;y++)
			{
				if(ReportDate[x].Data[y].Region.localeCompare(State) == 0)
				{
					DataArray[x].Cases += ReportDate[x].Data[y].Cases;
					DataArray[x].Deaths += ReportDate[x].Data[y].Deaths;
					DataArray[x].Pop += ReportDate[x].Data[y].Pop;
					DataArray[x].SqMi += ReportDate[x].Data[y].SqMi;
				}
			}
		}

		// eliminate 0 entries at start of series (uneven reporting among countries)
		for(y=x=0;x<DataArray.length;x++)
		{
			if(DataArray[x].Cases == 0)
				y++;
			else
				break;
		}

		for(x=0;x<y;x++)
			DataArray.shift();

		// make date text array
		var DateText = [];
		for(x=y;x<ReportDate.length;x++)
			DateText[x-y] = ReportDate[x].Date;

		for(x=0;x<DataArray.length;x++)
		{
			if(x == 0)
			{
				DataArray[x].DeltaCases = 0;
				DataArray[x].DeltaDeaths = 0;
			}
			else
			{
				DataArray[x].DeltaCases = DataArray[x].Cases - DataArray[x-1].Cases;
				if(DataArray[x].DeltaCases < 0)
					DataArray[x].DeltaCases = 0;
	
				DataArray[x].DeltaDeaths = DataArray[x].Deaths - DataArray[x-1].Deaths;
				if(DataArray[x].DeltaDeaths < 0)
					DataArray[x].DeltaDeaths = 0;
			}
		}

		// 10 day running average
		var RunningAverageDays = 10;
		for(x=0;x<DataArray.length;x++)
		{
			DataArray[x].RunningAverageCases = 0;
			DataArray[x].RunningAverageDeaths = 0;
			if(x < RunningAverageDays)
			{
				for(y=0;y<=x;y++)
				{
					DataArray[x].RunningAverageCases += DataArray[y].DeltaCases;
					DataArray[x].RunningAverageDeaths += DataArray[y].DeltaDeaths;
				}
				DataArray[x].RunningAverageCases /= (x+1);
				DataArray[x].RunningAverageDeaths /= (x+1);
			}
			else
			{
				for(y=x-RunningAverageDays;y<=x;y++)
				{
					DataArray[x].RunningAverageCases += DataArray[y].DeltaCases;
					DataArray[x].RunningAverageDeaths += DataArray[y].DeltaDeaths;
				}
				DataArray[x].RunningAverageCases /= (RunningAverageDays+1);
				DataArray[x].RunningAverageDeaths /= (RunningAverageDays+1);
			}

			if(x == 0)
			{
				DataArray[x].TrendCases = 0;
				DataArray[x].TrendDeaths = 0;
			}
			else
			{
				DataArray[x].TrendCases = DataArray[x].RunningAverageCases - DataArray[x-1].RunningAverageCases;
				DataArray[x].TrendDeaths = DataArray[x].RunningAverageDeaths - DataArray[x-1].RunningAverageDeaths;
			}
		}

		// Now go through history data and create chart series
		var Cases = [];
		var Deaths = [];
		var DeltaCases = [];
		var DeltaDeaths = [];

		for(x=0;x<DataArray.length;x++)
		{
			Cases[x] = DataArray[x].Cases;
			Deaths[x] = DataArray[x].Deaths;
			DeltaCases[x] = DataArray[x].DeltaCases;
			DeltaDeaths[x] = DataArray[x].DeltaDeaths;
		}

		ClickData = DataArray[x-1];
		if(ClickData.Pop != 0)
		{
			ClickData.PerCapita = ClickData.Cases / ClickData.Pop;
			ClickData.DeathsPerCapita = ClickData.Deaths / ClickData.Pop;
			if(ClickData.Cases > 0)
				ClickData.DeathRate = ClickData.Deaths / ClickData.Cases;
			else
				ClickData.DeathRate = 0;
		}
		else
		{
			ClickData.PerCapita = 0;
			ClickData.DeathsPerCapita = 0;
			ClickData.DeathRate = 0;
		}

		ClearScreen();
		
		DrawCountyData();

		XYChart(ChartLoc,ChartDim,ReportDate.length-1,"Total Cases",Cases,Deaths,1);

		DrawDates(ChartLoc[0],ChartLoc[1]+ChartDim[1]+20,ChartDim[0],DateText);
	
		XYChart([ChartLoc[0],ChartLoc[1]+ChartDim[1]+100],[ChartDim[0],ChartDim[1]],ReportDate.length-1,"Daily Cases With 10 Day Trend",DeltaCases,DeltaDeaths,0);

		DrawDates(ChartLoc[0],ChartLoc[1]+(ChartDim[1]*2)+120,ChartDim[0],DateText);

		return;
	}

	// we have to find out county data array
	var DataArray = ReportDate[DateIndex].Data;
	for(x=0;x<DataArray.length;x++)
	{
		if(	(DataArray[x].Prov.localeCompare(County) == 0) &&
			(DataArray[x].Region.localeCompare(State) == 0))
		{
			ClickData = DataArray[x];
			break;
		}
	}

	if(x == DataArray.length)
	{
		console.log(State + " " + County + " was not found");
		return;
	}
	
	// now get history data for that county
	var UndefinedData = { Cases : 0, Deaths : 0 };
	ClickData.HistoryData = new Array(ReportDate.length);	// for tying clickdata to other dates for graphs
	for(x=0;x<ReportDate.length;x++)
	{
		for(y=0;y<ReportDate[x].Data.length;y++)
		{
			if(	(ReportDate[x].Data[y].Region.localeCompare(ClickData.Region) == 0) && (ReportDate[x].Data[y].Prov.localeCompare(ClickData.Prov) == 0))
			// if((ReportDate[x].Data[y].Lat == ClickData.Lat) && (ReportDate[x].Data[y].Long == ClickData.Long))
			{
				ClickData.HistoryData[x] = ReportDate[x].Data[y];
				break;
			}
		}
		if(y == ReportDate[x].Data.length)	// was it not found?
			ClickData.HistoryData[x] = UndefinedData;
	}

	// eliminate leading non reporting data
	for(y=x=0;x<ClickData.HistoryData.length;x++)
	{
		if(ClickData.HistoryData[x].Cases == 0)
			y++;
		else
			break;
	}

	for(x=0;x<y;x++)
		ClickData.HistoryData.shift();

	// make date text array
	var DateText = [];
	for(x=y;x<ReportDate.length;x++)
		DateText[x-y] = ReportDate[x].Date;

	// Create some addition stats based on history

	// delta from prior date
	for(x=0;x<ClickData.HistoryData.length;x++)
	{
		if(x == 0)
		{
			ClickData.HistoryData[x].DeltaCases = 0;
			ClickData.HistoryData[x].DeltaDeaths = 0;
		}
		else
		{
			ClickData.HistoryData[x].DeltaCases = ClickData.HistoryData[x].Cases - ClickData.HistoryData[x-1].Cases;
			if(ClickData.HistoryData[x].DeltaCases < 0)
				ClickData.HistoryData[x].DeltaCases = 0;

			ClickData.HistoryData[x].DeltaDeaths = ClickData.HistoryData[x].Deaths - ClickData.HistoryData[x-1].Deaths;
			if(ClickData.HistoryData[x].DeltaDeaths < 0)
				ClickData.HistoryData[x].DeltaDeaths = 0;
		}
	}

	// 10 day running average
	var RunningAverageDays = 10;
	for(x=0;x<ClickData.HistoryData.length;x++)
	{
		ClickData.HistoryData[x].RunningAverageCases = 0;
		ClickData.HistoryData[x].RunningAverageDeaths = 0;
		if(x < RunningAverageDays)
		{
			for(y=0;y<=x;y++)
			{
				ClickData.HistoryData[x].RunningAverageCases += ClickData.HistoryData[y].DeltaCases;
				ClickData.HistoryData[x].RunningAverageDeaths += ClickData.HistoryData[y].DeltaDeaths;
			}
			ClickData.HistoryData[x].RunningAverageCases /= (x+1);
			ClickData.HistoryData[x].RunningAverageDeaths /= (x+1);
		}
		else
		{
			for(y=x-RunningAverageDays;y<=x;y++)
			{
				ClickData.HistoryData[x].RunningAverageCases += ClickData.HistoryData[y].DeltaCases;
				ClickData.HistoryData[x].RunningAverageDeaths += ClickData.HistoryData[y].DeltaDeaths;
			}
			ClickData.HistoryData[x].RunningAverageCases /= (RunningAverageDays+1);
			ClickData.HistoryData[x].RunningAverageDeaths /= (RunningAverageDays+1);
		}

		if(x == 0)
		{
			ClickData.HistoryData[x].TrendCases = 0;
			ClickData.HistoryData[x].TrendDeaths = 0;
		}
		else
		{
			ClickData.HistoryData[x].TrendCases = ClickData.HistoryData[x].RunningAverageCases - ClickData.HistoryData[x-1].RunningAverageCases;
			ClickData.HistoryData[x].TrendDeaths = ClickData.HistoryData[x].RunningAverageDeaths - ClickData.HistoryData[x-1].RunningAverageDeaths;
		}
	}

	// Now go through history data and create chart series
	var Cases = [];
	var Deaths = [];
	var DeltaCases = [];
	var DeltaDeaths = [];

	for(x=0;x<ClickData.HistoryData.length;x++)
	{
		Cases[x] = ClickData.HistoryData[x].Cases;
		Deaths[x] = ClickData.HistoryData[x].Deaths;
		DeltaCases[x] = ClickData.HistoryData[x].DeltaCases;
		DeltaDeaths[x] = ClickData.HistoryData[x].DeltaDeaths;
	}

	ClearScreen();
	
	DrawCountyData();

	XYChart(ChartLoc,ChartDim,ReportDate.length-1,"Total Cases",Cases,Deaths,1);

	DrawDates(ChartLoc[0],ChartLoc[1]+ChartDim[1]+20,ChartDim[0],DateText);

	XYChart([ChartLoc[0],ChartLoc[1]+ChartDim[1]+100],[ChartDim[0],ChartDim[1]],ReportDate.length-1,"Daily Cases With 10 Day Trend",DeltaCases,DeltaDeaths,0);

	DrawDates(ChartLoc[0],ChartLoc[1]+(ChartDim[1]*2)+120,ChartDim[0],DateText);
}

</script>

</html>
